<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StripeÊ±∫Ê∏à„Ç∑„Çπ„ÉÜ„É† - „Ç§„É≥„Éï„É´„Ç®„É≥„Çµ„Éº„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        
        .navbar h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .login-container {
            max-width: 500px;
            margin: 5rem auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 120px);
        }
        
        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
        }
        
        .sidebar nav ul {
            list-style: none;
        }
        
        .sidebar nav li {
            margin: 1rem 0;
        }
        
        .sidebar nav a {
            display: block;
            padding: 1rem 1.5rem;
            text-decoration: none;
            color: #495057;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .sidebar nav a:hover, .sidebar nav a.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateX(5px);
        }
        
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .payment-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .payment-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .payment-form {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: white;
            margin-bottom: 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .payment-item-info {
            flex: 1;
        }
        
        .payment-item-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .payment-item-desc {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .payment-amount {
            font-weight: 700;
            font-size: 1.2rem;
            color: #28a745;
        }
        
        .form-group {
            margin: 1rem 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #495057;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .hidden { display: none; }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            border: 1px solid #f5c6cb;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            border: 1px solid #c3e6cb;
        }
        
        .info-message {
            background: #d1ecf1;
            color: #0c5460;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            border: 1px solid #bee5eb;
        }
        
        .payment-status {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-refunded {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .invoice-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: white;
            margin-bottom: 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .invoice-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .invoice-actions button {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stats-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stats-value {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .stats-label {
            color: #6c757d;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 0 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
    <nav class="navbar">
        <h1>üí≥ StripeÊ±∫Ê∏à„Ç∑„Çπ„ÉÜ„É†</h1>
        <div class="user-info">
            <span id="user-display">„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ</span>
            <button id="logout-btn" class="btn btn-secondary hidden" onclick="logout()">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
        </div>
    </nav>

    <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
    <div id="login-screen" class="login-container">
        <h2 style="text-align: center; margin-bottom: 2rem;">„É≠„Ç∞„Ç§„É≥</h2>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <div>
                <h3>üè¢ ‰ºÅÊ•≠„É≠„Ç∞„Ç§„É≥</h3>
                <form id="company-form">
                    <div class="form-group">
                        <label>„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                        <input type="email" value="company@test.com" readonly>
                    </div>
                    <div class="form-group">
                        <label>„Éë„Çπ„ÉØ„Éº„Éâ</label>
                        <input type="password" value="test123" readonly>
                    </div>
                    <button type="submit" class="btn">‰ºÅÊ•≠„Å®„Åó„Å¶„É≠„Ç∞„Ç§„É≥</button>
                </form>
            </div>
            
            <div>
                <h3>‚≠ê „Ç§„É≥„Éï„É´„Ç®„É≥„Çµ„Éº„É≠„Ç∞„Ç§„É≥</h3>
                <form id="influencer-form">
                    <div class="form-group">
                        <label>„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                        <input type="email" value="influencer@test.com" readonly>
                    </div>
                    <div class="form-group">
                        <label>„Éë„Çπ„ÉØ„Éº„Éâ</label>
                        <input type="password" value="test123" readonly>
                    </div>
                    <button type="submit" class="btn">„Ç§„É≥„Éï„É´„Ç®„É≥„Çµ„Éº„Å®„Åó„Å¶„É≠„Ç∞„Ç§„É≥</button>
                </form>
            </div>
        </div>
    </div>

    <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ -->
    <div id="dashboard-screen" class="container hidden">
        <div class="dashboard">
            <!-- „Çµ„Ç§„Éâ„Éê„Éº -->
            <div class="sidebar">
                <nav>
                    <ul>
                        <li><a href="#" onclick="showSection('payment-processing', this)" class="active">üí≥ Ê±∫Ê∏àÂá¶ÁêÜ</a></li>
                        <li><a href="#" onclick="showSection('invoice-management', this)">üìÑ Ë´ãÊ±ÇÊõ∏ÁÆ°ÁêÜ</a></li>
                        <li><a href="#" onclick="showSection('payment-history', this)">üìä Ê±∫Ê∏àÂ±•Ê≠¥</a></li>
                        <li><a href="#" onclick="showSection('refunds', this)">‚Ü©Ô∏è ËøîÈáëÁÆ°ÁêÜ</a></li>
                        <li><a href="#" onclick="showSection('analytics', this)">üìà ÂàÜÊûê</a></li>
                    </ul>
                </nav>
            </div>

            <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div class="main-content">
                <!-- Ê±∫Ê∏àÂá¶ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div id="payment-processing-section">
                    <div class="payment-header">
                        <h2>üí≥ Ê±∫Ê∏àÂá¶ÁêÜ</h2>
                        <p>„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆÊ±∫Ê∏à„ÇíÁ∞°Âçò„Å´Âá¶ÁêÜ„Åß„Åç„Åæ„Åô</p>
                    </div>
                    
                    <div class="payment-form">
                        <h3>Êñ∞Ë¶èÊ±∫Ê∏à‰ΩúÊàê</h3>
                        <form id="payment-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>„Éó„É≠„Ç∏„Çß„ÇØ„ÉàID</label>
                                    <input type="text" id="project-id" placeholder="„Éó„É≠„Ç∏„Çß„ÇØ„ÉàID„ÇíÂÖ•Âäõ" required>
                                </div>
                                <div class="form-group">
                                    <label>Ê±∫Ê∏àÈáëÈ°çÔºàÂÜÜÔºâ</label>
                                    <input type="number" id="amount" placeholder="100000" min="1" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ÈÄöË≤®</label>
                                    <select id="currency">
                                        <option value="jpy">Êó•Êú¨ÂÜÜ (JPY)</option>
                                        <option value="usd">Á±≥„Éâ„É´ (USD)</option>
                                        <option value="eur">„É¶„Éº„É≠ (EUR)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ê±∫Ê∏àÊñπÊ≥ï</label>
                                    <select id="payment-method">
                                        <option value="card">„ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„Éâ</option>
                                        <option value="bank_transfer">ÈäÄË°åÊåØËæº</option>
                                        <option value="wallet">ÈõªÂ≠ê„Éû„Éç„Éº</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>ÂÇôËÄÉ</label>
                                <textarea id="payment-note" placeholder="Ê±∫Ê∏à„Å´Èñ¢„Åô„ÇãÂÇôËÄÉÔºà‰ªªÊÑèÔºâ" rows="3"></textarea>
                            </div>
                            
                            <button type="submit" class="btn">Ê±∫Ê∏à„Çí‰ΩúÊàê</button>
                        </form>
                        
                        <div id="payment-result"></div>
                    </div>
                </div>

                <!-- Ë´ãÊ±ÇÊõ∏ÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div id="invoice-management-section" class="hidden">
                    <div class="payment-header">
                        <h2>üìÑ Ë´ãÊ±ÇÊõ∏ÁÆ°ÁêÜ</h2>
                        <p>Ë´ãÊ±ÇÊõ∏„ÅÆ‰ΩúÊàê„ÉªÁÆ°ÁêÜ„ÇíÂäπÁéáÁöÑ„Å´Ë°å„Åà„Åæ„Åô</p>
                    </div>
                    
                    <div class="payment-form">
                        <h3>Êñ∞Ë¶èË´ãÊ±ÇÊõ∏‰ΩúÊàê</h3>
                        <form id="invoice-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>È°ßÂÆ¢ID</label>
                                    <input type="text" id="customer-id" placeholder="È°ßÂÆ¢ID„ÇíÂÖ•Âäõ" required>
                                </div>
                                <div class="form-group">
                                    <label>Ë´ãÊ±ÇÈáëÈ°çÔºàÂÜÜÔºâ</label>
                                    <input type="number" id="invoice-amount" placeholder="100000" min="1" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ÊîØÊâïÊúüÈôê</label>
                                    <input type="date" id="due-date" required>
                                </div>
                                <div class="form-group">
                                    <label>„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                                    <select id="invoice-status">
                                        <option value="draft">‰∏ãÊõ∏„Åç</option>
                                        <option value="sent">ÈÄÅ‰ø°Ê∏à„Åø</option>
                                        <option value="paid">ÊîØÊâïÊ∏à„Åø</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Ë´ãÊ±ÇÂÜÖÂÆπ</label>
                                <textarea id="invoice-description" placeholder="Ë´ãÊ±ÇÂÜÖÂÆπ„ÇíÂÖ•Âäõ" rows="3" required></textarea>
                            </div>
                            
                            <button type="submit" class="btn">Ë´ãÊ±ÇÊõ∏„Çí‰ΩúÊàê</button>
                        </form>
                        
                        <div id="invoice-result"></div>
                    </div>
                    
                    <div class="payment-section">
                        <h3>Ë´ãÊ±ÇÊõ∏‰∏ÄË¶ß</h3>
                        <button class="btn" onclick="loadInvoices()">Ë´ãÊ±ÇÊõ∏„ÇíË™≠„ÅøËæº„Åø</button>
                        <div id="invoices-list"></div>
                    </div>
                </div>

                <!-- Ê±∫Ê∏àÂ±•Ê≠¥„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div id="payment-history-section" class="hidden">
                    <div class="payment-header">
                        <h2>üìä Ê±∫Ê∏àÂ±•Ê≠¥</h2>
                        <p>„Åô„Åπ„Å¶„ÅÆÊ±∫Ê∏àÂèñÂºï„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô</p>
                    </div>
                    
                    <div class="payment-section">
                        <div class="form-row">
                            <div class="form-group">
                                <label>„Éó„É≠„Ç∏„Çß„ÇØ„ÉàIDÔºà„Éï„Ç£„É´„ÇøÔºâ</label>
                                <input type="text" id="filter-project" placeholder="„Éó„É≠„Ç∏„Çß„ÇØ„ÉàID„Åß„Éï„Ç£„É´„Çø">
                            </div>
                            <div class="form-group">
                                <label>„Çπ„ÉÜ„Éº„Çø„ÇπÔºà„Éï„Ç£„É´„ÇøÔºâ</label>
                                <select id="filter-status">
                                    <option value="">„Åô„Åπ„Å¶</option>
                                    <option value="pending">‰øùÁïô‰∏≠</option>
                                    <option value="completed">ÂÆå‰∫Ü</option>
                                    <option value="failed">Â§±Êïó</option>
                                </select>
                            </div>
                        </div>
                        
                        <button class="btn" onclick="loadPaymentHistory()">Ê±∫Ê∏àÂ±•Ê≠¥„ÇíË™≠„ÅøËæº„Åø</button>
                        <div id="payment-history-list"></div>
                    </div>
                </div>

                <!-- ËøîÈáëÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div id="refunds-section" class="hidden">
                    <div class="payment-header">
                        <h2>‚Ü©Ô∏è ËøîÈáëÁÆ°ÁêÜ</h2>
                        <p>ËøîÈáëÂá¶ÁêÜ„ÇíÂÆâÂÖ®„Å´ÂÆüË°å„Åß„Åç„Åæ„Åô</p>
                    </div>
                    
                    <div class="payment-form">
                        <h3>ËøîÈáëÂá¶ÁêÜ</h3>
                        <form id="refund-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ê±∫Ê∏àID</label>
                                    <input type="text" id="refund-payment-id" placeholder="Ê±∫Ê∏àID„ÇíÂÖ•Âäõ" required>
                                </div>
                                <div class="form-group">
                                    <label>ËøîÈáëÈáëÈ°çÔºàÂÜÜÔºâ</label>
                                    <input type="number" id="refund-amount" placeholder="ËøîÈáëÈáëÈ°ç„ÇíÂÖ•Âäõ" min="1" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>ËøîÈáëÁêÜÁî±</label>
                                <textarea id="refund-reason" placeholder="ËøîÈáëÁêÜÁî±„ÇíÂÖ•Âäõ" rows="3" required></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-warning">ËøîÈáë„ÇíÂÆüË°å</button>
                        </form>
                        
                        <div id="refund-result"></div>
                    </div>
                    
                    <div class="payment-section">
                        <h3>ËøîÈáëÂ±•Ê≠¥</h3>
                        <button class="btn" onclick="loadRefunds()">ËøîÈáëÂ±•Ê≠¥„ÇíË™≠„ÅøËæº„Åø</button>
                        <div id="refunds-list"></div>
                    </div>
                </div>

                <!-- ÂàÜÊûê„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div id="analytics-section" class="hidden">
                    <div class="payment-header">
                        <h2>üìà Ê±∫Ê∏àÂàÜÊûê</h2>
                        <p>Ê±∫Ê∏à„Éá„Éº„Çø„ÅÆË©≥Á¥∞„Å™ÂàÜÊûêÊÉÖÂ†±„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stats-card">
                            <div class="stats-value" id="total-revenue">¬•0</div>
                            <div class="stats-label">Á∑èÂ£≤‰∏ä</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-value" id="total-transactions">0</div>
                            <div class="stats-label">Á∑èÂèñÂºïÊï∞</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-value" id="success-rate">0%</div>
                            <div class="stats-label">ÊàêÂäüÁéá</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-value" id="avg-amount">¬•0</div>
                            <div class="stats-label">Âπ≥ÂùáÂèñÂºïÈ°ç</div>
                        </div>
                    </div>
                    
                    <div class="payment-section">
                        <button class="btn" onclick="loadAnalytics()">ÂàÜÊûê„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø</button>
                        <div id="analytics-result"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        const BACKEND_URL = 'http://localhost:5002';
        
        // „É≠„Ç∞„Ç§„É≥Ê©üËÉΩ
        async function login(email, password) {
            try {
                const response = await fetch(`${BACKEND_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentUser = data.user;
                    
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('dashboard-screen').classList.remove('hidden');
                    document.getElementById('user-display').textContent = `${data.user.email} (${data.user.role})`;
                    document.getElementById('logout-btn').classList.remove('hidden');
                    
                    showSection('payment-processing');
                    
                } else {
                    const error = await response.json();
                    alert(`„É≠„Ç∞„Ç§„É≥„Ç®„É©„Éº: ${error.error}`);
                }
            } catch (error) {
                alert(`Êé•Á∂ö„Ç®„É©„Éº: ${error.message}`);
            }
        }
        
        // „É≠„Ç∞„Ç¢„Ç¶„Éà
        function logout() {
            currentUser = null;
            document.getElementById('dashboard-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('user-display').textContent = '„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
            document.getElementById('logout-btn').classList.add('hidden');
        }
        
        // „Çª„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫Âàá„ÇäÊõø„Åà
        function showSection(sectionName, element = null) {
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.classList.add('hidden');
            });
            
            document.getElementById(`${sectionName}-section`).classList.remove('hidden');
            
            document.querySelectorAll('.sidebar nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            if (element) {
                element.classList.add('active');
            }
        }
        
        // Ê±∫Ê∏à‰ΩúÊàê
        async function createPayment(event) {
            event.preventDefault();
            
            const projectId = document.getElementById('project-id').value;
            const amount = parseInt(document.getElementById('amount').value);
            const currency = document.getElementById('currency').value;
            const paymentMethod = document.getElementById('payment-method').value;
            const note = document.getElementById('payment-note').value;
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/payments`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        projectId,
                        amount,
                        currency,
                        paymentMethod,
                        note,
                        userId: currentUser.id
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('payment-result').innerHTML = 
                        `<div class="success-message">‚úÖ Ê±∫Ê∏à„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü„ÄÇÊ±∫Ê∏àID: ${result.payment.id}</div>`;
                    document.getElementById('payment-form').reset();
                } else {
                    document.getElementById('payment-result').innerHTML = 
                        `<div class="error-message">‚ùå „Ç®„É©„Éº: ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('payment-result').innerHTML = 
                    `<div class="error-message">‚ùå Êé•Á∂ö„Ç®„É©„Éº: ${error.message}</div>`;
            }
        }
        
        // Ë´ãÊ±ÇÊõ∏‰ΩúÊàê
        async function createInvoice(event) {
            event.preventDefault();
            
            const customerId = document.getElementById('customer-id').value;
            const amount = parseInt(document.getElementById('invoice-amount').value);
            const dueDate = document.getElementById('due-date').value;
            const status = document.getElementById('invoice-status').value;
            const description = document.getElementById('invoice-description').value;
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/invoices`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        customerId,
                        amount,
                        dueDate,
                        status,
                        description
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('invoice-result').innerHTML = 
                        `<div class="success-message">‚úÖ Ë´ãÊ±ÇÊõ∏„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü„ÄÇË´ãÊ±ÇÊõ∏ID: ${result.invoice.id}</div>`;
                    document.getElementById('invoice-form').reset();
                } else {
                    document.getElementById('invoice-result').innerHTML = 
                        `<div class="error-message">‚ùå „Ç®„É©„Éº: ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('invoice-result').innerHTML = 
                    `<div class="error-message">‚ùå Êé•Á∂ö„Ç®„É©„Éº: ${error.message}</div>`;
            }
        }
        
        // Ë´ãÊ±ÇÊõ∏‰∏ÄË¶ßË™≠„ÅøËæº„Åø
        async function loadInvoices() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/invoices`);
                const data = await response.json();
                
                const invoicesList = document.getElementById('invoices-list');
                invoicesList.innerHTML = data.invoices.map(invoice => `
                    <div class="invoice-item">
                        <div>
                            <div class="payment-item-title">Ë´ãÊ±ÇÊõ∏ #${invoice.id}</div>
                            <div class="payment-item-desc">
                                È°ßÂÆ¢: ${invoice.customerId} | ÊúüÈôê: ${new Date(invoice.dueDate).toLocaleDateString()}
                            </div>
                            <div class="payment-item-desc">${invoice.description}</div>
                        </div>
                        <div style="text-align: right;">
                            <div class="payment-amount">¬•${invoice.amount.toLocaleString()}</div>
                            <div class="payment-status status-${invoice.status}">${getStatusText(invoice.status)}</div>
                        </div>
                        <div class="invoice-actions">
                            <button class="btn btn-secondary" onclick="viewInvoice('${invoice.id}')">Ë©≥Á¥∞</button>
                            <button class="btn btn-success" onclick="payInvoice('${invoice.id}')">ÊîØÊâï„ÅÑ</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('invoices-list').innerHTML = 
                    `<div class="error-message">‚ùå Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº: ${error.message}</div>`;
            }
        }
        
        // Ê±∫Ê∏àÂ±•Ê≠¥Ë™≠„ÅøËæº„Åø
        async function loadPaymentHistory() {
            const projectFilter = document.getElementById('filter-project').value;
            const statusFilter = document.getElementById('filter-status').value;
            
            let url = `${BACKEND_URL}/api/payments`;
            const params = new URLSearchParams();
            if (projectFilter) params.append('projectId', projectFilter);
            if (statusFilter) params.append('status', statusFilter);
            if (params.toString()) url += `?${params.toString()}`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                const historyList = document.getElementById('payment-history-list');
                historyList.innerHTML = data.payments.map(payment => `
                    <div class="payment-item">
                        <div>
                            <div class="payment-item-title">Ê±∫Ê∏à #${payment.id}</div>
                            <div class="payment-item-desc">
                                „Éó„É≠„Ç∏„Çß„ÇØ„Éà: ${payment.projectId} | ÊñπÊ≥ï: ${payment.paymentMethod}
                            </div>
                            <div class="payment-item-desc">
                                ‰ΩúÊàêÊó•: ${new Date(payment.createdAt).toLocaleString()}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="payment-amount">¬•${payment.amount.toLocaleString()}</div>
                            <div class="payment-status status-${payment.status}">${getStatusText(payment.status)}</div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('payment-history-list').innerHTML = 
                    `<div class="error-message">‚ùå Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº: ${error.message}</div>`;
            }
        }
        
        // ËøîÈáëÂá¶ÁêÜ
        async function processRefund(event) {
            event.preventDefault();
            
            const paymentId = document.getElementById('refund-payment-id').value;
            const amount = parseInt(document.getElementById('refund-amount').value);
            const reason = document.getElementById('refund-reason').value;
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/refunds`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        paymentId,
                        amount,
                        reason
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('refund-result').innerHTML = 
                        `<div class="success-message">‚úÖ ËøîÈáë„ÇíÂá¶ÁêÜ„Åó„Åæ„Åó„Åü„ÄÇËøîÈáëID: ${result.refund.id}</div>`;
                    document.getElementById('refund-form').reset();
                } else {
                    document.getElementById('refund-result').innerHTML = 
                        `<div class="error-message">‚ùå „Ç®„É©„Éº: ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('refund-result').innerHTML = 
                    `<div class="error-message">‚ùå Êé•Á∂ö„Ç®„É©„Éº: ${error.message}</div>`;
            }
        }
        
        // ËøîÈáëÂ±•Ê≠¥Ë™≠„ÅøËæº„Åø
        async function loadRefunds() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/refunds`);
                const data = await response.json();
                
                const refundsList = document.getElementById('refunds-list');
                refundsList.innerHTML = data.refunds.map(refund => `
                    <div class="payment-item">
                        <div>
                            <div class="payment-item-title">ËøîÈáë #${refund.id}</div>
                            <div class="payment-item-desc">
                                ÂÖÉÊ±∫Ê∏à: ${refund.paymentId} | ÁêÜÁî±: ${refund.reason}
                            </div>
                            <div class="payment-item-desc">
                                Âá¶ÁêÜÊó•: ${new Date(refund.createdAt).toLocaleString()}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="payment-amount">¬•${refund.amount.toLocaleString()}</div>
                            <div class="payment-status status-refunded">ËøîÈáëÊ∏à„Åø</div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('refunds-list').innerHTML = 
                    `<div class="error-message">‚ùå Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº: ${error.message}</div>`;
            }
        }
        
        // ÂàÜÊûê„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadAnalytics() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/analytics/payments`);
                const data = await response.json();
                
                // Áµ±Ë®àÊÉÖÂ†±„ÇíÊõ¥Êñ∞
                document.getElementById('total-revenue').textContent = `¬•${data.totalRevenue.toLocaleString()}`;
                document.getElementById('total-transactions').textContent = data.totalTransactions;
                document.getElementById('success-rate').textContent = `${data.successRate}%`;
                document.getElementById('avg-amount').textContent = `¬•${data.avgAmount.toLocaleString()}`;
                
                // Ë©≥Á¥∞ÂàÜÊûêÁµêÊûú„ÇíË°®Á§∫
                const analyticsResult = document.getElementById('analytics-result');
                analyticsResult.innerHTML = `
                    <div class="info-message">
                        <h4>üìä Ê±∫Ê∏àÂàÜÊûê„É¨„Éù„Éº„Éà</h4>
                        <p>Á∑èÂ£≤‰∏ä: ¬•${data.totalRevenue.toLocaleString()}</p>
                        <p>Á∑èÂèñÂºïÊï∞: ${data.totalTransactions}‰ª∂</p>
                        <p>ÊàêÂäüÁéá: ${data.successRate}%</p>
                        <p>Âπ≥ÂùáÂèñÂºïÈ°ç: ¬•${data.avgAmount.toLocaleString()}</p>
                        <p>ÊúÄÈ´òÂèñÂºïÈ°ç: ¬•${data.maxAmount.toLocaleString()}</p>
                        <p>ÊúÄ‰ΩéÂèñÂºïÈ°ç: ¬•${data.minAmount.toLocaleString()}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('analytics-result').innerHTML = 
                    `<div class="error-message">‚ùå ÂàÜÊûê„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº: ${error.message}</div>`;
            }
        }
        
        // „Çπ„ÉÜ„Éº„Çø„Çπ„ÉÜ„Ç≠„Çπ„ÉàÂ§âÊèõ
        function getStatusText(status) {
            const statusMap = {
                'pending': '‰øùÁïô‰∏≠',
                'completed': 'ÂÆå‰∫Ü',
                'failed': 'Â§±Êïó',
                'refunded': 'ËøîÈáëÊ∏à„Åø',
                'draft': '‰∏ãÊõ∏„Åç',
                'sent': 'ÈÄÅ‰ø°Ê∏à„Åø',
                'paid': 'ÊîØÊâïÊ∏à„Åø'
            };
            return statusMap[status] || status;
        }
        
        // Ë´ãÊ±ÇÊõ∏Ë©≥Á¥∞Ë°®Á§∫
        async function viewInvoice(invoiceId) {
            alert(`Ë´ãÊ±ÇÊõ∏ #${invoiceId} „ÅÆË©≥Á¥∞„ÇíË°®Á§∫„Åó„Åæ„Åô`);
        }
        
        // Ë´ãÊ±ÇÊõ∏ÊîØÊâï„ÅÑ
        async function payInvoice(invoiceId) {
            const confirmed = confirm(`Ë´ãÊ±ÇÊõ∏ #${invoiceId} „ÅÆÊîØÊâï„ÅÑ„ÇíÂá¶ÁêÜ„Åó„Åæ„Åô„ÅãÔºü`);
            if (confirmed) {
                alert(`Ë´ãÊ±ÇÊõ∏ #${invoiceId} „ÅÆÊîØÊâï„ÅÑ„ÇíÂá¶ÁêÜ„Åó„Åæ„Åó„Åü`);
                loadInvoices();
            }
        }
        
        // ‰ªäÊó•„ÅÆÊó•‰ªò„ÇíË®≠ÂÆö
        function setTodayDate() {
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            document.getElementById('due-date').value = nextWeek.toISOString().split('T')[0];
        }
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        document.getElementById('company-form').addEventListener('submit', (e) => {
            e.preventDefault();
            login('company@test.com', 'test123');
        });
        
        document.getElementById('influencer-form').addEventListener('submit', (e) => {
            e.preventDefault();
            login('influencer@test.com', 'test123');
        });
        
        document.getElementById('payment-form').addEventListener('submit', createPayment);
        document.getElementById('invoice-form').addEventListener('submit', createInvoice);
        document.getElementById('refund-form').addEventListener('submit', processRefund);
        
        // ÂàùÊúüÂåñ
        window.onload = function() {
            setTodayDate();
        };
    </script>
</body>
</html>