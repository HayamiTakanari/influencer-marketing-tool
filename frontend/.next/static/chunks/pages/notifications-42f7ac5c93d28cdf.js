(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[769],{1865:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/notifications",function(){return t(9313)}])},9313:function(e,a,t){"use strict";t.r(a);var l=t(5893),r=t(7294),s=t(5841),i=t(1163),n=t(1664),d=t.n(n);a.default=()=>{let[e,a]=(0,r.useState)(null),[n,o]=(0,r.useState)([]),[c,x]=(0,r.useState)(!0),[b,u]=(0,r.useState)(""),[m,h]=(0,r.useState)("all"),[p,g]=(0,r.useState)(null),[y,N]=(0,r.useState)({page:1,limit:20,total:0,totalPages:0}),E=(0,i.useRouter)();(0,r.useEffect)(()=>{let e=localStorage.getItem("user"),t=localStorage.getItem("token");e&&t?(a(JSON.parse(e)),f()):E.push("/login")},[E,m]);let f=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{let{getNotifications:a}=await Promise.all([t.e(66),t.e(184)]).then(t.bind(t,2184)),l=await a(e,20,"unread"===m);o(l.notifications||[]),N(l.pagination||{page:1,limit:20,total:0,totalPages:0})}catch(e){console.error("Error fetching notifications:",e),u("通知の取得に失敗しました。")}finally{x(!1)}},j=async e=>{g(e);try{let{markNotificationAsRead:a}=await Promise.all([t.e(66),t.e(184)]).then(t.bind(t,2184));await a(e),o(a=>a.map(a=>a.id===e?{...a,isRead:!0,readAt:new Date().toISOString()}:a))}catch(e){console.error("Error marking notification as read:",e)}finally{g(null)}},w=async()=>{if(confirm("すべての通知を既読にしますか？")){g("all");try{let{markAllNotificationsAsRead:e}=await Promise.all([t.e(66),t.e(184)]).then(t.bind(t,2184));await e(),o(e=>e.map(e=>({...e,isRead:!0,readAt:new Date().toISOString()}))),alert("すべての通知を既読にしました。")}catch(e){console.error("Error marking all notifications as read:",e),alert("既読処理に失敗しました。")}finally{g(null)}}},v=async e=>{if(confirm("この通知を削除しますか？")){g(e);try{let{deleteNotification:a}=await Promise.all([t.e(66),t.e(184)]).then(t.bind(t,2184));await a(e),o(a=>a.filter(a=>a.id!==e))}catch(e){console.error("Error deleting notification:",e),alert("通知の削除に失敗しました。")}finally{g(null)}}},D=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),C=e=>({APPLICATION_RECEIVED:"\uD83D\uDCDD",APPLICATION_ACCEPTED:"✅",APPLICATION_REJECTED:"❌",PROJECT_MATCHED:"\uD83E\uDD1D",MESSAGE_RECEIVED:"\uD83D\uDCAC",PAYMENT_COMPLETED:"\uD83D\uDCB0",PROJECT_STATUS_CHANGED:"\uD83D\uDD04",TEAM_INVITATION:"\uD83D\uDC65",SYSTEM_ANNOUNCEMENT:"\uD83D\uDCE2"})[e]||"\uD83D\uDCDD",T=e=>({APPLICATION_RECEIVED:"border-blue-200 bg-blue-50/50",APPLICATION_ACCEPTED:"border-green-200 bg-green-50/50",APPLICATION_REJECTED:"border-red-200 bg-red-50/50",PROJECT_MATCHED:"border-purple-200 bg-purple-50/50",MESSAGE_RECEIVED:"border-indigo-200 bg-indigo-50/50",PAYMENT_COMPLETED:"border-emerald-200 bg-emerald-50/50",PROJECT_STATUS_CHANGED:"border-orange-200 bg-orange-50/50",TEAM_INVITATION:"border-cyan-200 bg-cyan-50/50",SYSTEM_ANNOUNCEMENT:"border-yellow-200 bg-yellow-50/50"})[e]||"border-gray-200 bg-gray-50/50",A=e=>{e.isRead||j(e.id),e.data&&(e.data.projectId?E.push("/projects/".concat(e.data.projectId)):e.data.applicationId?E.push("/applications"):e.data.teamId&&E.push("/team-management"))};return c?(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})}):(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50",children:[(0,l.jsx)("div",{className:"bg-white/80 backdrop-blur-xl border-b border-gray-200 sticky top-0 z-10",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)(d(),{href:"/dashboard",className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-white font-bold",children:"IM"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"通知"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"あなたの通知を確認"})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)("span",{className:"text-gray-700",children:null==e?void 0:e.email}),(0,l.jsx)(d(),{href:"/dashboard",className:"px-4 py-2 text-gray-600 hover:text-blue-600 transition-colors",children:"ダッシュボード"})]})]})}),(0,l.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[b&&(0,l.jsx)(s.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6",children:b}),(0,l.jsx)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-6 shadow-xl mb-8",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"flex gap-2",children:[{value:"all",label:"すべて"},{value:"unread",label:"未読のみ"}].map(e=>(0,l.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>h(e.value),className:"px-4 py-2 rounded-xl font-medium transition-all ".concat(m===e.value?"bg-blue-500 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.value))}),(0,l.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:w,disabled:"all"===p,className:"px-4 py-2 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all disabled:opacity-50",children:"all"===p?"処理中...":"全て既読にする"})]})}),(0,l.jsx)("div",{className:"space-y-4",children:0===n.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD14"}),(0,l.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"通知がありません"}),(0,l.jsx)("p",{className:"text-gray-600",children:"新しい通知が届くとここに表示されます。"})]}):n.map((e,a)=>(0,l.jsx)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.05*a},className:"border rounded-3xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer ".concat(e.isRead?"bg-white/80 border-gray-200":"".concat(T(e.type)," border-l-4")," ").concat(e.isRead?"":"border-l-blue-500"),onClick:()=>A(e),children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex items-start space-x-4 flex-1",children:[(0,l.jsx)("div",{className:"text-2xl",children:C(e.type)}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,l.jsx)("h3",{className:"font-bold ".concat(e.isRead?"text-gray-700":"text-gray-900"),children:e.title}),!e.isRead&&(0,l.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full"})]}),(0,l.jsx)("p",{className:"text-gray-600 mb-2",children:e.message}),(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:[D(e.createdAt),e.readAt&&(0,l.jsxs)("span",{className:"ml-2",children:["• 既読: ",D(e.readAt)]})]})]})]}),(0,l.jsxs)("div",{className:"flex space-x-2 ml-4",children:[!e.isRead&&(0,l.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:a=>{a.stopPropagation(),j(e.id)},disabled:p===e.id,className:"px-3 py-1 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50",children:p===e.id?"処理中...":"既読"}),(0,l.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:a=>{a.stopPropagation(),v(e.id)},disabled:p===e.id,className:"px-3 py-1 text-sm border border-red-300 text-red-700 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50",children:"削除"})]})]})},e.id))}),y.totalPages>1&&(0,l.jsx)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-6 shadow-xl mt-8",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"text-gray-600",children:[y.total,"件中 ",(y.page-1)*y.limit+1," - ",Math.min(y.page*y.limit,y.total),"件を表示"]}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>f(y.page-1),disabled:1===y.page,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"前へ"}),(0,l.jsxs)("span",{className:"px-4 py-2 text-gray-600",children:[y.page," / ",y.totalPages]}),(0,l.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>f(y.page+1),disabled:y.page===y.totalPages,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"次へ"})]})]})})]})]})}},1163:function(e,a,t){e.exports=t(3079)}},function(e){e.O(0,[841,664,888,774,179],function(){return e(e.s=1865)}),_N_E=e.O()}]);