(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8769],{1865:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/notifications",function(){return a(9313)}])},9313:function(e,t,a){"use strict";a.r(t);var s=a(5893),l=a(7294),i=a(8083),r=a(1163),n=a(1664),d=a.n(n);t.default=()=>{let[e,t]=(0,l.useState)(null),[n,c]=(0,l.useState)([]),[o,x]=(0,l.useState)(0),[m,h]=(0,l.useState)(!0),[g,p]=(0,l.useState)(""),[u,b]=(0,l.useState)("all"),[y,N]=(0,l.useState)(null),[f,j]=(0,l.useState)({page:1,limit:20,total:0,totalPages:0}),[D,E]=(0,l.useState)(null),[w,v]=(0,l.useState)([]),[C,T]=(0,l.useState)(!1),A=(0,r.useRouter)();(0,l.useEffect)(()=>{let e=localStorage.getItem("user"),a=localStorage.getItem("token");e&&a?(t(JSON.parse(e)),P()):A.push("/login")},[A,u]);let P=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{let{getNotifications:t}=await Promise.all([a.e(7066),a.e(2184)]).then(a.bind(a,2184)),s=await t(e,20,"unread"===u);c(s.notifications||[]),j(s.pagination||{page:1,limit:20,total:0,totalPages:0}),x((s.notifications||[]).filter(e=>!e.isRead).length),I(s.notifications||[]),_(s.notifications||[])}catch(e){console.error("Error fetching notifications:",e),p("通知の取得に失敗しました。")}finally{h(!1)}},I=e=>{let t=new Date,a=new Date(t.getTime()-6048e5),s=new Date(t.getTime()-2592e6),l=e.filter(e=>new Date(e.createdAt)>=a),i=e.filter(e=>new Date(e.createdAt)>=s),r=e.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{}),n=e.length>0?(e.filter(e=>e.isRead).length/e.length*100).toFixed(1):"0",d=e.filter(e=>e.isRead&&e.readAt).map(e=>new Date(e.readAt).getTime()-new Date(e.createdAt).getTime()).reduce((e,t,a,s)=>e+t/s.length,0);E({total:e.length,unread:e.filter(e=>!e.isRead).length,recent7Days:l.length,recent30Days:i.length,readRate:parseFloat(n),avgResponseTime:Math.round(d/36e5),typeDistribution:r,highPriority:e.filter(e=>"high"===L(e.type)).length})},_=e=>{let t=[],a=e.filter(e=>!e.isRead),s=a.filter(e=>"high"===L(e.type));s.length>0&&t.push({type:"urgent",title:"重要な未読通知があります",message:"".concat(s.length,"件の重要な通知を確認してください"),action:()=>b("unread"),icon:"\uD83D\uDEA8"}),a.length>10&&t.push({type:"bulk_action",title:"一括処理をお勧めします",message:"".concat(a.length,"件の未読通知があります。一括で既読にしませんか？"),action:S,icon:"\uD83D\uDCDA"});let l=e.filter(e=>"APPLICATION_RECEIVED"===e.type&&!e.isRead);l.length>=3&&t.push({type:"workflow",title:"新しい応募が複数あります",message:"".concat(l.length,"件の応募を確認し、対応を検討してください"),action:()=>A.push("/applications"),icon:"\uD83D\uDCDD"});let i=a.filter(e=>(Date.now()-new Date(e.createdAt).getTime())/864e5>7);i.length>0&&t.push({type:"maintenance",title:"古い未読通知があります",message:"1週間以上前の未読通知が".concat(i.length,"件あります"),action:()=>b("unread"),icon:"\uD83D\uDDC2️"}),v(t)},R=async e=>{N(e);try{let{markNotificationAsRead:t}=await Promise.all([a.e(7066),a.e(2184)]).then(a.bind(a,2184));await t(e),c(t=>t.map(t=>t.id===e?{...t,isRead:!0,readAt:new Date().toISOString()}:t))}catch(e){console.error("Error marking notification as read:",e)}finally{N(null)}},S=async()=>{if(confirm("すべての通知を既読にしますか？")){N("all");try{let{markAllNotificationsAsRead:e}=await Promise.all([a.e(7066),a.e(2184)]).then(a.bind(a,2184));await e(),c(e=>e.map(e=>({...e,isRead:!0,readAt:new Date().toISOString()}))),alert("すべての通知を既読にしました。")}catch(e){console.error("Error marking all notifications as read:",e),alert("既読処理に失敗しました。")}finally{N(null)}}},O=async e=>{if(confirm("この通知を削除しますか？")){N(e);try{let{deleteNotification:t}=await Promise.all([a.e(7066),a.e(2184)]).then(a.bind(a,2184));await t(e),c(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Error deleting notification:",e),alert("通知の削除に失敗しました。")}finally{N(null)}}},k=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),M=e=>({APPLICATION_RECEIVED:"\uD83D\uDCDD",APPLICATION_ACCEPTED:"✅",APPLICATION_REJECTED:"❌",PROJECT_MATCHED:"\uD83E\uDD1D",MESSAGE_RECEIVED:"\uD83D\uDCAC",PAYMENT_COMPLETED:"\uD83D\uDCB0",PROJECT_STATUS_CHANGED:"\uD83D\uDD04",TEAM_INVITATION:"\uD83D\uDC65",SYSTEM_ANNOUNCEMENT:"\uD83D\uDCE2"})[e]||"\uD83D\uDCDD",H=e=>({APPLICATION_RECEIVED:"border-blue-200 bg-blue-50/50",APPLICATION_ACCEPTED:"border-green-200 bg-green-50/50",APPLICATION_REJECTED:"border-red-200 bg-red-50/50",PROJECT_MATCHED:"border-purple-200 bg-purple-50/50",MESSAGE_RECEIVED:"border-indigo-200 bg-indigo-50/50",PAYMENT_COMPLETED:"border-emerald-200 bg-emerald-50/50",PROJECT_STATUS_CHANGED:"border-orange-200 bg-orange-50/50",TEAM_INVITATION:"border-cyan-200 bg-cyan-50/50",SYSTEM_ANNOUNCEMENT:"border-yellow-200 bg-yellow-50/50"})[e]||"border-gray-200 bg-gray-50/50",L=e=>["APPLICATION_ACCEPTED","PAYMENT_COMPLETED","PROJECT_MATCHED"].includes(e)?"high":["APPLICATION_RECEIVED","MESSAGE_RECEIVED","TEAM_INVITATION"].includes(e)?"medium":"low",V=e=>({high:{text:"重要",className:"bg-red-100 text-red-700"},medium:{text:"普通",className:"bg-yellow-100 text-yellow-700"},low:{text:"低",className:"bg-gray-100 text-gray-700"}})[L(e)],J=e=>{e.isRead||R(e.id),e.data&&(e.data.projectId?A.push("/projects/".concat(e.data.projectId)):e.data.applicationId?A.push("/applications"):e.data.teamId&&A.push("/team-management"))};return m?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50",children:[(0,s.jsx)("div",{className:"bg-white/80 backdrop-blur-xl border-b border-gray-200 sticky top-0 z-10",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(d(),{href:"/dashboard",className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold",children:"IM"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-xl font-bold text-gray-900",children:["通知",o>0&&(0,s.jsx)("span",{className:"ml-2 px-2 py-1 text-xs bg-red-500 text-white rounded-full",children:o})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"あなたの通知を確認"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("span",{className:"text-gray-700",children:null==e?void 0:e.email}),(0,s.jsx)(d(),{href:"/dashboard",className:"px-4 py-2 text-gray-600 hover:text-blue-600 transition-colors",children:"ダッシュボード"})]})]})}),(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[g&&(0,s.jsx)(i.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6",children:g}),(0,s.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-6 shadow-xl mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("div",{className:"flex gap-2",children:[{value:"all",label:"すべて"},{value:"unread",label:"未読のみ"}].map(e=>(0,s.jsx)(i.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>b(e.value),className:"px-4 py-2 rounded-xl font-medium transition-all ".concat(u===e.value?"bg-blue-500 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.value))}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(i.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>T(!C),className:"px-4 py-2 bg-purple-500 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all",children:"\uD83D\uDCCA 分析表示"}),(0,s.jsx)(i.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:S,disabled:"all"===y,className:"px-4 py-2 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all disabled:opacity-50",children:"all"===y?"処理中...":"全て既読にする"})]})]}),C&&D&&(0,s.jsxs)(i.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"border-t border-gray-200 pt-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCC8 通知分析"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:D.total}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"総通知数"})]}),(0,s.jsxs)("div",{className:"text-center p-4 bg-gradient-to-br from-red-50 to-red-100 rounded-xl",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-red-600",children:D.unread}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"未読数"})]}),(0,s.jsxs)("div",{className:"text-center p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-xl",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:[D.readRate,"%"]}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"既読率"})]}),(0,s.jsxs)("div",{className:"text-center p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-purple-600",children:[D.avgResponseTime,"h"]}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"平均応答時間"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-900 mb-3",children:"期間別統計"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"過去7日"}),(0,s.jsxs)("span",{className:"font-semibold",children:[D.recent7Days,"件"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"過去30日"}),(0,s.jsxs)("span",{className:"font-semibold",children:[D.recent30Days,"件"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"重要通知"}),(0,s.jsxs)("span",{className:"font-semibold text-red-600",children:[D.highPriority,"件"]})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-900 mb-3",children:"通知タイプ別"}),(0,s.jsx)("div",{className:"space-y-2",children:Object.entries(D.typeDistribution).slice(0,5).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{className:"text-gray-600 flex items-center",children:[M(t),(0,s.jsx)("span",{className:"ml-2 text-xs",children:t.replace("_"," ")})]}),(0,s.jsxs)("span",{className:"font-semibold",children:[a,"件"]})]},t)})})]})]})]})]}),w.length>0&&(0,s.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.1},className:"bg-gradient-to-br from-yellow-50 to-orange-50 border border-yellow-200 rounded-3xl p-6 shadow-xl mb-8",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:"\uD83E\uDD16 スマート提案"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:w.map((e,t)=>(0,s.jsx)(i.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.1*t},className:"bg-white rounded-xl p-4 shadow-md border border-yellow-100",children:(0,s.jsx)("div",{className:"flex items-start justify-between",children:(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:e.icon}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-900 mb-1",children:e.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:e.message}),(0,s.jsx)(i.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:e.action,className:"px-3 py-1 bg-yellow-500 text-white rounded-lg text-sm font-medium hover:bg-yellow-600 transition-colors",children:"実行"})]})]})})},t))})]}),(0,s.jsx)("div",{className:"space-y-4",children:0===n.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD14"}),(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"通知がありません"}),(0,s.jsx)("p",{className:"text-gray-600",children:"新しい通知が届くとここに表示されます。"})]}):n.map((e,t)=>(0,s.jsx)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.05*t},className:"border rounded-3xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer ".concat(e.isRead?"bg-white/80 border-gray-200":"".concat(H(e.type)," border-l-4")," ").concat(e.isRead?"":"high"===L(e.type)?"border-l-red-500":"medium"===L(e.type)?"border-l-yellow-500":"border-l-gray-400"),onClick:()=>J(e),children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-start space-x-4 flex-1",children:[(0,s.jsx)("div",{className:"text-2xl",children:M(e.type)}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,s.jsx)("h3",{className:"font-bold ".concat(e.isRead?"text-gray-700":"text-gray-900"),children:e.title}),!e.isRead&&(0,s.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,s.jsx)("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full ".concat(V(e.type).className),children:V(e.type).text})]}),(0,s.jsx)("p",{className:"text-gray-600 mb-2",children:e.message}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[k(e.createdAt),e.readAt&&(0,s.jsxs)("span",{className:"ml-2",children:["• 既読: ",k(e.readAt)]})]})]})]}),(0,s.jsxs)("div",{className:"flex space-x-2 ml-4",children:[!e.isRead&&(0,s.jsx)(i.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:t=>{t.stopPropagation(),R(e.id)},disabled:y===e.id,className:"px-3 py-1 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50",children:y===e.id?"処理中...":"既読"}),(0,s.jsx)(i.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:t=>{t.stopPropagation(),O(e.id)},disabled:y===e.id,className:"px-3 py-1 text-sm border border-red-300 text-red-700 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50",children:"削除"})]})]})},e.id))}),f.totalPages>1&&(0,s.jsx)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-6 shadow-xl mt-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-gray-600",children:[f.total,"件中 ",(f.page-1)*f.limit+1," - ",Math.min(f.page*f.limit,f.total),"件を表示"]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(i.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>P(f.page-1),disabled:1===f.page,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"前へ"}),(0,s.jsxs)("span",{className:"px-4 py-2 text-gray-600",children:[f.page," / ",f.totalPages]}),(0,s.jsx)(i.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>P(f.page+1),disabled:f.page===f.totalPages,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"次へ"})]})]})})]})]})}},1163:function(e,t,a){e.exports=a(3079)}},function(e){e.O(0,[8083,1664,2888,9774,179],function(){return e(e.s=1865)}),_N_E=e.O()}]);