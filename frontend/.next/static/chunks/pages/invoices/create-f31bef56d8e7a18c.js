(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2266],{6017:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/invoices/create",function(){return a(6491)}])},6491:function(e,t,a){"use strict";a.r(t);var n=a(5893),s=a(7294),r=a(5841),l=a(1163),o=a(2184);t.default=()=>{let[e,t]=(0,s.useState)(null),[a,i]=(0,s.useState)(!1),[c,d]=(0,s.useState)(""),[u,x]=(0,s.useState)([]),m=(0,l.useRouter)(),[p,h]=(0,s.useState)({projectId:"",title:"",description:"",dueDate:"",paymentMethod:"銀行振込",bankInfo:{bankName:"",branchName:"",accountType:"普通",accountNumber:"",accountName:""}}),[b,g]=(0,s.useState)([{description:"",quantity:1,unitPrice:0,amount:0,taxRate:10,taxAmount:0,totalAmount:0}]);(0,s.useEffect)(()=>{let e=localStorage.getItem("user");if(!e){m.push("/login");return}let a=JSON.parse(e);if(t(a),"INFLUENCER"!==a.role){m.push("/dashboard");return}f();let n=new Date;n.setDate(n.getDate()+30),h(e=>({...e,dueDate:n.toISOString().split("T")[0]}))},[m]);let f=async()=>{try{let e=await (0,o.getMyProjects)();x(Array.isArray(e)?e:e.projects||[])}catch(e){console.error("Error fetching projects:",e),x([])}},y=(e,t,a)=>{let n=[...b],s={...n[e]};s[t]=a,("quantity"===t||"unitPrice"===t)&&(s.amount=s.quantity*s.unitPrice),("amount"===t||"taxRate"===t)&&(s.taxAmount=Math.floor(s.amount*(s.taxRate/100))),s.totalAmount=s.amount+s.taxAmount,n[e]=s,g(n)},j=e=>{b.length>1&&g(b.filter((t,a)=>a!==e))},N=async e=>{if(e.preventDefault(),d(""),!p.projectId){d("プロジェクトを選択してください。");return}if(!p.title.trim()){d("請求書タイトルを入力してください。");return}if(!p.dueDate){d("支払期限を設定してください。");return}let t=b.filter(e=>e.description.trim()&&e.unitPrice>0);if(0===t.length){d("少なくとも1つの有効な明細項目を入力してください。");return}try{i(!0);let e={projectId:p.projectId,title:p.title,description:p.description||void 0,dueDate:p.dueDate,items:t,paymentMethod:p.paymentMethod||void 0,bankInfo:p.bankInfo.bankName?p.bankInfo:void 0},a=await (0,o.Z$)(e);m.push("/invoices/".concat(a.id))}catch(e){console.error("Error creating invoice:",e),d("請求書の作成に失敗しました。")}finally{i(!1)}},{subtotal:v,taxAmount:k,totalAmount:w}=(()=>{let e=b.reduce((e,t)=>e+t.amount,0),t=b.reduce((e,t)=>e+t.taxAmount,0);return{subtotal:e,taxAmount:t,totalAmount:e+t}})(),I=e=>new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY",minimumFractionDigits:0}).format(e);return e?(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4 mb-8",children:[(0,n.jsxs)("button",{onClick:()=>m.push("/invoices"),className:"flex items-center space-x-2 px-4 py-2 bg-white/80 backdrop-blur-xl rounded-xl shadow-lg hover:shadow-xl transition-all text-gray-700 hover:text-blue-600",children:[(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),(0,n.jsx)("span",{className:"font-medium",children:"請求書一覧に戻る"})]}),(0,n.jsx)(r.E.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"請求書作成"})]}),c&&(0,n.jsx)(r.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6",children:c}),(0,n.jsx)("form",{onSubmit:N,children:(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 shadow-lg",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"基本情報"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"関連プロジェクト *"}),(0,n.jsxs)("select",{value:p.projectId,onChange:e=>h({...p,projectId:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,n.jsx)("option",{value:"",children:"プロジェクトを選択してください"}),u.map(e=>(0,n.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"支払期限 *"}),(0,n.jsx)("input",{type:"date",value:p.dueDate,onChange:e=>h({...p,dueDate:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,n.jsxs)("div",{className:"md:col-span-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"請求書タイトル *"}),(0,n.jsx)("input",{type:"text",value:p.title,onChange:e=>h({...p,title:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例: プロジェクト完了に伴う請求書",required:!0})]}),(0,n.jsxs)("div",{className:"md:col-span-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"説明・備考"}),(0,n.jsx)("textarea",{value:p.description,onChange:e=>h({...p,description:e.target.value}),rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"請求内容の詳細説明..."})]})]})]}),(0,n.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 shadow-lg",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"明細"}),(0,n.jsxs)("button",{type:"button",onClick:()=>{g([...b,{description:"",quantity:1,unitPrice:0,amount:0,taxRate:10,taxAmount:0,totalAmount:0}])},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,n.jsx)("span",{children:"項目を追加"})]})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,n.jsx)("th",{className:"text-left py-2 px-2 font-semibold text-gray-900",children:"項目"}),(0,n.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-gray-900",children:"数量"}),(0,n.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-gray-900",children:"単価"}),(0,n.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-gray-900",children:"小計"}),(0,n.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-gray-900",children:"税率"}),(0,n.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-gray-900",children:"税額"}),(0,n.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-gray-900",children:"合計"}),(0,n.jsx)("th",{className:"py-2 px-2"})]})}),(0,n.jsx)("tbody",{children:b.map((e,t)=>(0,n.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,n.jsx)("td",{className:"py-3 px-2",children:(0,n.jsx)("input",{type:"text",value:e.description,onChange:e=>y(t,"description",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"サービス内容"})}),(0,n.jsx)("td",{className:"py-3 px-2",children:(0,n.jsx)("input",{type:"number",value:e.quantity,onChange:e=>y(t,"quantity",parseInt(e.target.value)||0),className:"w-20 px-2 py-1 border border-gray-300 rounded text-right focus:outline-none focus:ring-1 focus:ring-blue-500",min:"1"})}),(0,n.jsx)("td",{className:"py-3 px-2",children:(0,n.jsx)("input",{type:"number",value:e.unitPrice,onChange:e=>y(t,"unitPrice",parseInt(e.target.value)||0),className:"w-24 px-2 py-1 border border-gray-300 rounded text-right focus:outline-none focus:ring-1 focus:ring-blue-500",min:"0"})}),(0,n.jsx)("td",{className:"py-3 px-2 text-right font-medium",children:I(e.amount)}),(0,n.jsx)("td",{className:"py-3 px-2",children:(0,n.jsxs)("select",{value:e.taxRate,onChange:e=>y(t,"taxRate",parseInt(e.target.value)),className:"w-16 px-1 py-1 border border-gray-300 rounded text-right focus:outline-none focus:ring-1 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:0,children:"0%"}),(0,n.jsx)("option",{value:8,children:"8%"}),(0,n.jsx)("option",{value:10,children:"10%"})]})}),(0,n.jsx)("td",{className:"py-3 px-2 text-right text-gray-600",children:I(e.taxAmount)}),(0,n.jsx)("td",{className:"py-3 px-2 text-right font-semibold",children:I(e.totalAmount)}),(0,n.jsx)("td",{className:"py-3 px-2",children:b.length>1&&(0,n.jsx)("button",{type:"button",onClick:()=>j(t),className:"text-red-600 hover:text-red-800",children:(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},t))})]})}),(0,n.jsx)("div",{className:"mt-6 flex justify-end",children:(0,n.jsx)("div",{className:"w-80",children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"小計:"}),(0,n.jsx)("span",{className:"font-medium",children:I(v)})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"消費税:"}),(0,n.jsx)("span",{className:"font-medium",children:I(k)})]}),(0,n.jsx)("div",{className:"border-t pt-2",children:(0,n.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,n.jsx)("span",{children:"合計:"}),(0,n.jsx)("span",{className:"text-blue-600",children:I(w)})]})})]})})})]}),(0,n.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 shadow-lg",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"支払情報"}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"支払方法"}),(0,n.jsxs)("select",{value:p.paymentMethod,onChange:e=>h({...p,paymentMethod:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"銀行振込",children:"銀行振込"}),(0,n.jsx)("option",{value:"現金",children:"現金"}),(0,n.jsx)("option",{value:"クレジットカード",children:"クレジットカード"}),(0,n.jsx)("option",{value:"その他",children:"その他"})]})]})}),"銀行振込"===p.paymentMethod&&(0,n.jsxs)("div",{className:"mt-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"振込先情報"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"銀行名"}),(0,n.jsx)("input",{type:"text",value:p.bankInfo.bankName,onChange:e=>h({...p,bankInfo:{...p.bankInfo,bankName:e.target.value}}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"みずほ銀行"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"支店名"}),(0,n.jsx)("input",{type:"text",value:p.bankInfo.branchName,onChange:e=>h({...p,bankInfo:{...p.bankInfo,branchName:e.target.value}}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"渋谷支店"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"口座種別"}),(0,n.jsxs)("select",{value:p.bankInfo.accountType,onChange:e=>h({...p,bankInfo:{...p.bankInfo,accountType:e.target.value}}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"普通",children:"普通"}),(0,n.jsx)("option",{value:"当座",children:"当座"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"口座番号"}),(0,n.jsx)("input",{type:"text",value:p.bankInfo.accountNumber,onChange:e=>h({...p,bankInfo:{...p.bankInfo,accountNumber:e.target.value}}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1234567"})]}),(0,n.jsxs)("div",{className:"md:col-span-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"口座名義"}),(0,n.jsx)("input",{type:"text",value:p.bankInfo.accountName,onChange:e=>h({...p,bankInfo:{...p.bankInfo,accountName:e.target.value}}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"タナカ タロウ"})]})]})]})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,n.jsx)("button",{type:"button",onClick:()=>m.push("/invoices"),className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors font-medium",children:"キャンセル"}),(0,n.jsx)("button",{type:"submit",disabled:a,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl hover:shadow-lg transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:a?"作成中...":"請求書を作成"})]})]})})]})}):null}},1163:function(e,t,a){e.exports=a(3079)}},function(e){e.O(0,[5841,7066,2184,2888,9774,179],function(){return e(e.s=6017)}),_N_E=e.O()}]);