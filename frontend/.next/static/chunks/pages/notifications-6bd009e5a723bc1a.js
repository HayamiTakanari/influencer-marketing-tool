(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8769],{1865:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/notifications",function(){return t(9313)}])},9313:function(e,a,t){"use strict";t.r(a);var l=t(5893),s=t(7294),r=t(5841),i=t(1163),n=t(1664),d=t.n(n);a.default=()=>{let[e,a]=(0,s.useState)(null),[n,o]=(0,s.useState)([]),[c,x]=(0,s.useState)(0),[m,u]=(0,s.useState)(!0),[b,h]=(0,s.useState)(""),[p,g]=(0,s.useState)("all"),[y,N]=(0,s.useState)(null),[E,f]=(0,s.useState)({page:1,limit:20,total:0,totalPages:0}),j=(0,i.useRouter)();(0,s.useEffect)(()=>{let e=localStorage.getItem("user"),t=localStorage.getItem("token");e&&t?(a(JSON.parse(e)),w()):j.push("/login")},[j,p]);let w=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{let{getNotifications:a}=await Promise.all([t.e(7066),t.e(2184)]).then(t.bind(t,2184)),l=await a(e,20,"unread"===p);o(l.notifications||[]),f(l.pagination||{page:1,limit:20,total:0,totalPages:0}),x((l.notifications||[]).filter(e=>!e.isRead).length)}catch(e){console.error("Error fetching notifications:",e),h("通知の取得に失敗しました。")}finally{u(!1)}},D=async e=>{N(e);try{let{markNotificationAsRead:a}=await Promise.all([t.e(7066),t.e(2184)]).then(t.bind(t,2184));await a(e),o(a=>a.map(a=>a.id===e?{...a,isRead:!0,readAt:new Date().toISOString()}:a))}catch(e){console.error("Error marking notification as read:",e)}finally{N(null)}},v=async()=>{if(confirm("すべての通知を既読にしますか？")){N("all");try{let{markAllNotificationsAsRead:e}=await Promise.all([t.e(7066),t.e(2184)]).then(t.bind(t,2184));await e(),o(e=>e.map(e=>({...e,isRead:!0,readAt:new Date().toISOString()}))),alert("すべての通知を既読にしました。")}catch(e){console.error("Error marking all notifications as read:",e),alert("既読処理に失敗しました。")}finally{N(null)}}},C=async e=>{if(confirm("この通知を削除しますか？")){N(e);try{let{deleteNotification:a}=await Promise.all([t.e(7066),t.e(2184)]).then(t.bind(t,2184));await a(e),o(a=>a.filter(a=>a.id!==e))}catch(e){console.error("Error deleting notification:",e),alert("通知の削除に失敗しました。")}finally{N(null)}}},T=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),A=e=>({APPLICATION_RECEIVED:"\uD83D\uDCDD",APPLICATION_ACCEPTED:"✅",APPLICATION_REJECTED:"❌",PROJECT_MATCHED:"\uD83E\uDD1D",MESSAGE_RECEIVED:"\uD83D\uDCAC",PAYMENT_COMPLETED:"\uD83D\uDCB0",PROJECT_STATUS_CHANGED:"\uD83D\uDD04",TEAM_INVITATION:"\uD83D\uDC65",SYSTEM_ANNOUNCEMENT:"\uD83D\uDCE2"})[e]||"\uD83D\uDCDD",P=e=>({APPLICATION_RECEIVED:"border-blue-200 bg-blue-50/50",APPLICATION_ACCEPTED:"border-green-200 bg-green-50/50",APPLICATION_REJECTED:"border-red-200 bg-red-50/50",PROJECT_MATCHED:"border-purple-200 bg-purple-50/50",MESSAGE_RECEIVED:"border-indigo-200 bg-indigo-50/50",PAYMENT_COMPLETED:"border-emerald-200 bg-emerald-50/50",PROJECT_STATUS_CHANGED:"border-orange-200 bg-orange-50/50",TEAM_INVITATION:"border-cyan-200 bg-cyan-50/50",SYSTEM_ANNOUNCEMENT:"border-yellow-200 bg-yellow-50/50"})[e]||"border-gray-200 bg-gray-50/50",I=e=>["APPLICATION_ACCEPTED","PAYMENT_COMPLETED","PROJECT_MATCHED"].includes(e)?"high":["APPLICATION_RECEIVED","MESSAGE_RECEIVED","TEAM_INVITATION"].includes(e)?"medium":"low",_=e=>({high:{text:"重要",className:"bg-red-100 text-red-700"},medium:{text:"普通",className:"bg-yellow-100 text-yellow-700"},low:{text:"低",className:"bg-gray-100 text-gray-700"}})[I(e)],S=e=>{e.isRead||D(e.id),e.data&&(e.data.projectId?j.push("/projects/".concat(e.data.projectId)):e.data.applicationId?j.push("/applications"):e.data.teamId&&j.push("/team-management"))};return m?(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})}):(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50",children:[(0,l.jsx)("div",{className:"bg-white/80 backdrop-blur-xl border-b border-gray-200 sticky top-0 z-10",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)(d(),{href:"/dashboard",className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-white font-bold",children:"IM"})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h1",{className:"text-xl font-bold text-gray-900",children:["通知",c>0&&(0,l.jsx)("span",{className:"ml-2 px-2 py-1 text-xs bg-red-500 text-white rounded-full",children:c})]}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"あなたの通知を確認"})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)("span",{className:"text-gray-700",children:null==e?void 0:e.email}),(0,l.jsx)(d(),{href:"/dashboard",className:"px-4 py-2 text-gray-600 hover:text-blue-600 transition-colors",children:"ダッシュボード"})]})]})}),(0,l.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[b&&(0,l.jsx)(r.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6",children:b}),(0,l.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-6 shadow-xl mb-8",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"flex gap-2",children:[{value:"all",label:"すべて"},{value:"unread",label:"未読のみ"}].map(e=>(0,l.jsx)(r.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>g(e.value),className:"px-4 py-2 rounded-xl font-medium transition-all ".concat(p===e.value?"bg-blue-500 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.value))}),(0,l.jsx)(r.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:v,disabled:"all"===y,className:"px-4 py-2 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all disabled:opacity-50",children:"all"===y?"処理中...":"全て既読にする"})]})}),(0,l.jsx)("div",{className:"space-y-4",children:0===n.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD14"}),(0,l.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"通知がありません"}),(0,l.jsx)("p",{className:"text-gray-600",children:"新しい通知が届くとここに表示されます。"})]}):n.map((e,a)=>(0,l.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.05*a},className:"border rounded-3xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer ".concat(e.isRead?"bg-white/80 border-gray-200":"".concat(P(e.type)," border-l-4")," ").concat(e.isRead?"":"high"===I(e.type)?"border-l-red-500":"medium"===I(e.type)?"border-l-yellow-500":"border-l-gray-400"),onClick:()=>S(e),children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex items-start space-x-4 flex-1",children:[(0,l.jsx)("div",{className:"text-2xl",children:A(e.type)}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,l.jsx)("h3",{className:"font-bold ".concat(e.isRead?"text-gray-700":"text-gray-900"),children:e.title}),!e.isRead&&(0,l.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,l.jsx)("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full ".concat(_(e.type).className),children:_(e.type).text})]}),(0,l.jsx)("p",{className:"text-gray-600 mb-2",children:e.message}),(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:[T(e.createdAt),e.readAt&&(0,l.jsxs)("span",{className:"ml-2",children:["• 既読: ",T(e.readAt)]})]})]})]}),(0,l.jsxs)("div",{className:"flex space-x-2 ml-4",children:[!e.isRead&&(0,l.jsx)(r.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:a=>{a.stopPropagation(),D(e.id)},disabled:y===e.id,className:"px-3 py-1 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50",children:y===e.id?"処理中...":"既読"}),(0,l.jsx)(r.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:a=>{a.stopPropagation(),C(e.id)},disabled:y===e.id,className:"px-3 py-1 text-sm border border-red-300 text-red-700 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50",children:"削除"})]})]})},e.id))}),E.totalPages>1&&(0,l.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-6 shadow-xl mt-8",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"text-gray-600",children:[E.total,"件中 ",(E.page-1)*E.limit+1," - ",Math.min(E.page*E.limit,E.total),"件を表示"]}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(r.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>w(E.page-1),disabled:1===E.page,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"前へ"}),(0,l.jsxs)("span",{className:"px-4 py-2 text-gray-600",children:[E.page," / ",E.totalPages]}),(0,l.jsx)(r.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>w(E.page+1),disabled:E.page===E.totalPages,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"次へ"})]})]})})]})]})}},1163:function(e,a,t){e.exports=t(3079)}},function(e){e.O(0,[5841,1664,2888,9774,179],function(){return e(e.s=1865)}),_N_E=e.O()}]);