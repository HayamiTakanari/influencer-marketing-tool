(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[906],{9493:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project-schedule",function(){return a(9136)}])},9136:function(e,t,a){"use strict";a.r(t);var s=a(5893),i=a(7294),l=a(5841),n=a(1163),r=a(6635),c=a(2184);t.default=()=>{let[e,t]=(0,i.useState)("upcoming"),[a,o]=(0,i.useState)([]),[d,u]=(0,i.useState)(null),[x,m]=(0,i.useState)(null),[p,h]=(0,i.useState)([]),[b,g]=(0,i.useState)(!0),[y,f]=(0,i.useState)(""),[j,N]=(0,i.useState)(!1),[v,w]=(0,i.useState)(!1),[D,C]=(0,i.useState)(null),k=(0,n.useRouter)(),[E,S]=(0,i.useState)(null),[O,I]=(0,i.useState)({projectId:"",publishDate:"",milestones:[{type:"CONCEPT_APPROVAL",title:"構成案承認",description:"企画内容の承認を得る",dueDate:""},{type:"VIDEO_COMPLETION",title:"動画完成",description:"動画制作を完了する",dueDate:""},{type:"FINAL_APPROVAL",title:"最終承認",description:"最終コンテンツの承認を得る",dueDate:""}]}),[P,_]=(0,i.useState)({title:"",description:"",dueDate:"",isCompleted:!1}),L={CONCEPT_APPROVAL:"構成案承認",VIDEO_COMPLETION:"動画完成",FINAL_APPROVAL:"最終承認",PUBLISH_DATE:"投稿日"};(0,i.useEffect)(()=>{let e=localStorage.getItem("user");if(!e){k.push("/login");return}S(JSON.parse(e)),A()},[k]);let A=async()=>{try{g(!0);let[e,t]=await Promise.all([(0,c.getMyProjects)(),(0,r.Ul)(7)]);o(e.projects||[]),h(t.milestones||[])}catch(e){console.error("Error fetching data:",e),f("データの取得に失敗しました。")}finally{g(!1)}},T=async e=>{try{let t=await (0,r.pM)(e);m(t.schedule)}catch(e){console.error("Error fetching schedule:",e),m(null)}},V=async e=>{e.preventDefault();try{let e=new Date(O.publishDate),a=O.milestones.map((t,a)=>{let s=new Date(e);return s.setDate(e.getDate()-(3-a)*3),{...t,dueDate:s.toISOString()}}),s={projectId:O.projectId,publishDate:O.publishDate,milestones:a};await (0,r.F6)(s),N(!1),t("manage"),A(),T(O.projectId)}catch(e){console.error("Error creating schedule:",e),f("スケジュールの作成に失敗しました。")}},q=async e=>{if(e.preventDefault(),D)try{let e={...P,dueDate:P.dueDate?new Date(P.dueDate).toISOString():void 0};await (0,r.rd)(D.id,e),w(!1),C(null),d&&T(d.id),A()}catch(e){console.error("Error updating milestone:",e),f("マイルストーンの更新に失敗しました。")}},R=e=>{C(e),_({title:e.title,description:e.description||"",dueDate:e.dueDate.split("T")[0],isCompleted:e.isCompleted}),w(!0)},M=e=>{let t=new Date;return Math.ceil((new Date(e).getTime()-t.getTime())/864e5)},F=(e,t)=>{if(t)return"text-green-600";let a=M(e);return a<0?"text-red-600":a<=1?"text-orange-600":"text-gray-600"},U=()=>{I({projectId:"",publishDate:"",milestones:[{type:"CONCEPT_APPROVAL",title:"構成案承認",description:"企画内容の承認を得る",dueDate:""},{type:"VIDEO_COMPLETION",title:"動画完成",description:"動画制作を完了する",dueDate:""},{type:"FINAL_APPROVAL",title:"最終承認",description:"最終コンテンツの承認を得る",dueDate:""}]})};return b?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50",children:[(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsx)(l.E.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"プロジェクトスケジュール"}),(null==E?void 0:E.role)==="CLIENT"&&(0,s.jsx)(l.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{U(),N(!0)},className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all",children:"新規スケジュール作成"})]}),y&&(0,s.jsx)(l.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6",children:y}),(0,s.jsxs)("div",{className:"flex space-x-4 mb-8",children:[(0,s.jsx)("button",{onClick:()=>t("upcoming"),className:"px-6 py-3 rounded-xl font-semibold transition-all ".concat("upcoming"===e?"bg-blue-600 text-white shadow-lg":"bg-white/80 text-gray-700 hover:bg-white"),children:"今後の予定"}),(0,s.jsx)("button",{onClick:()=>t("manage"),className:"px-6 py-3 rounded-xl font-semibold transition-all ".concat("manage"===e?"bg-blue-600 text-white shadow-lg":"bg-white/80 text-gray-700 hover:bg-white"),children:"スケジュール管理"})]}),"upcoming"===e&&(0,s.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"今後7日間の予定"}),0===p.length?(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-gray-600 text-lg",children:"今後7日間の予定はありません。"})}):(0,s.jsx)("div",{className:"space-y-4",children:p.map(e=>{let t=M(e.dueDate),a=t<0,i=0===t,n=1===t;return(0,s.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 shadow-lg border-l-4 ".concat(a?"border-red-500":i?"border-orange-500":n?"border-yellow-500":"border-blue-500"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:e.title}),(0,s.jsx)("p",{className:"text-gray-600",children:e.schedule.project.title})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm font-medium ".concat(F(e.dueDate,e.isCompleted)),children:a?"".concat(Math.abs(t),"日遅れ"):i?"今日期限":n?"明日期限":"あと".concat(t,"日")}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.dueDate).toLocaleDateString()})]})]}),e.description&&(0,s.jsx)("p",{className:"text-gray-700 mb-3",children:e.description}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(e.isCompleted?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:L[e.type]}),!e.isCompleted&&(0,s.jsx)("button",{onClick:()=>R(e),className:"text-blue-600 hover:text-blue-800 text-sm font-medium transition-colors",children:"編集"})]})]},e.id)})})]}),"manage"===e&&(0,s.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"プロジェクト選択"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(e=>(0,s.jsxs)(l.E.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{u(e),T(e.id)},className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 shadow-lg cursor-pointer transition-all ".concat((null==d?void 0:d.id)===e.id?"ring-2 ring-blue-500":""),children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-2",children:e.title}),(0,s.jsx)("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:e.description}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat("IN_PROGRESS"===e.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.status}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleDateString()})]})]},e.id))}),d&&(0,s.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl p-8 shadow-lg",children:[(0,s.jsxs)("h3",{className:"text-2xl font-bold text-gray-800 mb-6",children:[d.title," のスケジュール"]}),x?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4 mb-6",children:[(0,s.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"投稿予定日"}),(0,s.jsx)("p",{className:"text-blue-700 text-lg",children:new Date(x.publishDate).toLocaleDateString()})]}),(0,s.jsx)("div",{className:"space-y-3",children:x.milestones.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl border-2 ".concat(e.isCompleted?"bg-green-50 border-green-200":"bg-white border-gray-200"),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"w-4 h-4 rounded-full ".concat(e.isCompleted?"bg-green-500":"bg-gray-300")}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-800",children:e.title}),e.description&&(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm font-medium ".concat(F(e.dueDate,e.isCompleted)),children:new Date(e.dueDate).toLocaleDateString()}),(0,s.jsx)("button",{onClick:()=>R(e),className:"text-blue-600 hover:text-blue-800 text-sm mt-1 transition-colors",children:"編集"})]})]},e.id))})]}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"このプロジェクトにはまだスケジュールが作成されていません。"}),(null==E?void 0:E.role)==="CLIENT"&&(0,s.jsx)("button",{onClick:()=>{I({...O,projectId:d.id}),N(!0)},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all",children:"スケジュールを作成"})]})]})]})]}),j&&(0,s.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,s.jsxs)(l.E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-3xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"スケジュール作成"}),(0,s.jsx)("button",{onClick:()=>N(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"✕"})]}),(0,s.jsxs)("form",{onSubmit:V,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"プロジェクト *"}),(0,s.jsxs)("select",{value:O.projectId,onChange:e=>I({...O,projectId:e.target.value}),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"",children:"プロジェクトを選択してください"}),a.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"投稿予定日 *"}),(0,s.jsx)("input",{type:"date",value:O.publishDate,onChange:e=>I({...O,publishDate:e.target.value}),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"マイルストーン（投稿日から自動逆算されます）"}),(0,s.jsx)("div",{className:"space-y-4",children:O.milestones.map((e,t)=>(0,s.jsx)("div",{className:"bg-gray-50 rounded-xl p-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"タイトル"}),(0,s.jsx)("input",{type:"text",value:e.title,onChange:e=>{let a=[...O.milestones];a[t]={...a[t],title:e.target.value},I({...O,milestones:a})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明"}),(0,s.jsx)("input",{type:"text",value:e.description,onChange:e=>{let a=[...O.milestones];a[t]={...a[t],description:e.target.value},I({...O,milestones:a})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})},t))})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>N(!1),className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors",children:"キャンセル"}),(0,s.jsx)("button",{type:"submit",className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl hover:shadow-lg transition-all",children:"作成"})]})]})]})}),v&&D&&(0,s.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,s.jsxs)(l.E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-3xl p-8 max-w-md w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"マイルストーン編集"}),(0,s.jsx)("button",{onClick:()=>{w(!1),C(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"✕"})]}),(0,s.jsxs)("form",{onSubmit:q,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"タイトル"}),(0,s.jsx)("input",{type:"text",value:P.title,onChange:e=>_({...P,title:e.target.value}),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明"}),(0,s.jsx)("textarea",{value:P.description,onChange:e=>_({...P,description:e.target.value}),rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"期限日"}),(0,s.jsx)("input",{type:"date",value:P.dueDate,onChange:e=>_({...P,dueDate:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:P.isCompleted,onChange:e=>_({...P,isCompleted:e.target.checked}),className:"mr-2"}),(0,s.jsx)("label",{className:"text-sm text-gray-700",children:"完了"})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{w(!1),C(null)},className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors",children:"キャンセル"}),(0,s.jsx)("button",{type:"submit",className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl hover:shadow-lg transition-all",children:"更新"})]})]})]})})]})}},6635:function(e,t,a){"use strict";a.d(t,{F6:function(){return f},NY:function(){return y},OY:function(){return c},Ol:function(){return u},UZ:function(){return n},Ul:function(){return j},VZ:function(){return h},Zx:function(){return i},a7:function(){return m},aP:function(){return b},e7:function(){return x},eW:function(){return o},mT:function(){return l},pM:function(){return N},r9:function(){return d},rd:function(){return v},sV:function(){return p},t$:function(){return g},u$:function(){return r}});let s=a(7066).Z.create({baseURL:"http://localhost:5002/api",headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e});let i=async e=>(await s.post("/achievements",e)).data,l=async()=>(await s.get("/achievements/my-achievements")).data,n=async()=>(await s.get("/achievements/stats")).data,r=async(e,t)=>(await s.put("/achievements/".concat(e),t)).data,c=async e=>(await s.delete("/achievements/".concat(e))).data,o=async e=>(await s.post("/service-pricing/bulk",e)).data,d=async()=>(await s.get("/service-pricing/my-pricing")).data,u=async()=>(await s.get("/service-pricing/validate")).data,x=async(e,t)=>(await s.put("/service-pricing/".concat(e),t)).data,m=async e=>(await s.delete("/service-pricing/".concat(e))).data,p=async e=>(await s.post("/bulk-inquiries",e)).data,h=async()=>(await s.get("/bulk-inquiries/my-inquiries")).data,b=async()=>(await s.get("/bulk-inquiries/my-responses")).data,g=async()=>(await s.get("/bulk-inquiries/stats")).data,y=async(e,t)=>(await s.put("/bulk-inquiries/response/".concat(e),t)).data,f=async e=>(await s.post("/schedules",e)).data,j=async e=>(await s.get("/schedules/upcoming",{params:{days:e}})).data,N=async e=>(await s.get("/schedules/project/".concat(e))).data,v=async(e,t)=>(await s.put("/schedules/milestone/".concat(e),t)).data},1163:function(e,t,a){e.exports=a(3079)}},function(e){e.O(0,[841,66,184,888,774,179],function(){return e(e.s=9493)}),_N_E=e.O()}]);