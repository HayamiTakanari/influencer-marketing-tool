(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[86],{7773:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/team-management",function(){return t(7952)}])},7952:function(e,l,t){"use strict";t.r(l);var a=t(5893),r=t(7294),s=t(5841),i=t(1163),n=t(1664),o=t.n(n);l.default=()=>{var e,l;let[n,d]=(0,r.useState)(null),[c,x]=(0,r.useState)(null),[m,u]=(0,r.useState)(!0),[h,b]=(0,r.useState)(""),[p,y]=(0,r.useState)(!1),[g,f]=(0,r.useState)(!1),[v,w]=(0,r.useState)(""),[j,N]=(0,r.useState)(""),[E,k]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),[O,D]=(0,r.useState)(null),[T,_]=(0,r.useState)(!1),H=(0,i.useRouter)();(0,r.useEffect)(()=>{let e=localStorage.getItem("user"),l=localStorage.getItem("token");if(e&&l){let l=JSON.parse(e);if(d(l),"CLIENT"!==l.role&&"COMPANY"!==l.role){H.push("/dashboard");return}P()}else H.push("/login")},[H]);let P=async()=>{try{let{getMyTeam:e}=await Promise.all([t.e(66),t.e(184)]).then(t.bind(t,2184)),l=await e();x(l),l&&w(l.name)}catch(l){var e;console.error("Error fetching team data:",l),(null===(e=l.response)||void 0===e?void 0:e.status)===404?x(null):b("チーム情報の取得に失敗しました。")}finally{u(!1)}},A=async e=>{if(e.preventDefault(),v.trim()){S(!0);try{let{createTeam:e}=await Promise.all([t.e(66),t.e(184)]).then(t.bind(t,2184)),l=await e({name:v.trim()});x(l),y(!1),w(l.name),await P()}catch(e){console.error("Error creating team:",e),b("チームの作成に失敗しました。")}finally{S(!1)}}},I=async e=>{if(e.preventDefault(),c&&v.trim()){S(!0);try{let{updateTeam:e}=await Promise.all([t.e(66),t.e(184)]).then(t.bind(t,2184)),l=await e(c.id,{name:v.trim()});x(l),_(!1),await P()}catch(e){console.error("Error updating team:",e),b("チーム名の更新に失敗しました。")}finally{S(!1)}}},F=async e=>{if(e.preventDefault(),c&&j.trim()){S(!0);try{let{addTeamMember:e}=await Promise.all([t.e(66),t.e(184)]).then(t.bind(t,2184));await e(c.id,{email:j.trim(),isOwner:E}),await P(),f(!1),N(""),k(!1),b("")}catch(e){var l,a;console.error("Error adding member:",e),b((null===(a=e.response)||void 0===a?void 0:null===(l=a.data)||void 0===l?void 0:l.error)||"メンバーの追加に失敗しました。")}finally{S(!1)}}},q=async(e,l)=>{if(c&&confirm("".concat(l," をチームから削除しますか？"))){D(e);try{let{removeTeamMember:l}=await Promise.all([t.e(66),t.e(184)]).then(t.bind(t,2184));await l(c.id,e),await P(),b("")}catch(e){var a,r;console.error("Error removing member:",e),b((null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.error)||"メンバーの削除に失敗しました。")}finally{D(null)}}},z=async(e,l,a)=>{if(c&&confirm("".concat(a," に").concat(l?"管理者権限を削除":"管理者権限を付与","しますか？"))){D(e);try{let{updateMemberRole:a}=await Promise.all([t.e(66),t.e(184)]).then(t.bind(t,2184));await a(c.id,e,{isOwner:!l}),await P(),b("")}catch(e){var r,s;console.error("Error updating member role:",e),b((null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.error)||"権限の更新に失敗しました。")}finally{D(null)}}},J=async()=>{if(c&&confirm("チームを削除しますか？この操作は取り消せません。")){S(!0);try{let{deleteTeam:e}=await Promise.all([t.e(66),t.e(184)]).then(t.bind(t,2184));await e(c.id),x(null),b("")}catch(t){var e,l;console.error("Error deleting team:",t),b((null===(l=t.response)||void 0===l?void 0:null===(e=l.data)||void 0===e?void 0:e.error)||"チームの削除に失敗しました。")}finally{S(!1)}}},L=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),M=!!n&&(e=n.id,(null==c?void 0:null===(l=c.members.find(l=>l.user.id===e))||void 0===l?void 0:l.isOwner)||!1);return m?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50",children:[(0,a.jsx)("div",{className:"bg-white/80 backdrop-blur-xl border-b border-gray-200 sticky top-0 z-10",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(o(),{href:"/dashboard",className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold",children:"IM"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"チーム管理"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"チームメンバーの管理と権限設定"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("span",{className:"text-gray-700",children:null==n?void 0:n.email}),(0,a.jsx)(o(),{href:"/dashboard",className:"px-4 py-2 text-gray-600 hover:text-blue-600 transition-colors",children:"ダッシュボード"})]})]})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[h&&(0,a.jsx)(s.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6",children:h}),c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-8 shadow-xl mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[T?(0,a.jsxs)("form",{onSubmit:I,className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"text",value:v,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:C,className:"px-3 py-1 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors disabled:opacity-50",children:C?"保存中...":"保存"}),(0,a.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"button",onClick:()=>{_(!1),w(c.name)},className:"px-3 py-1 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"キャンセル"})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:c.name}),M&&(0,a.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>_(!0),className:"px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"✏️ 編集"})]}),(0,a.jsxs)("p",{className:"text-gray-600 mt-2",children:["作成日: ",L(c.createdAt)]})]}),(0,a.jsx)("div",{className:"flex space-x-3",children:M&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>f(!0),className:"px-4 py-2 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all",children:"+ メンバー追加"}),(0,a.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:J,disabled:C,className:"px-4 py-2 border-2 border-red-300 text-red-700 rounded-xl font-semibold hover:bg-red-50 transition-colors disabled:opacity-50",children:"チーム削除"})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:c.members.length}),(0,a.jsx)("div",{className:"text-blue-800",children:"メンバー数"})]}),(0,a.jsxs)("div",{className:"bg-green-50 rounded-xl p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:c.members.filter(e=>e.isOwner).length}),(0,a.jsx)("div",{className:"text-green-800",children:"管理者数"})]}),(0,a.jsxs)("div",{className:"bg-purple-50 rounded-xl p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:c.clients.length}),(0,a.jsx)("div",{className:"text-purple-800",children:"関連クライアント"})]})]})]}),(0,a.jsxs)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-8 shadow-xl",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:"チームメンバー"}),(0,a.jsx)("div",{className:"space-y-4",children:c.members.map((e,l)=>(0,a.jsxs)(s.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1*l},className:"flex items-center justify-between p-4 border border-gray-200 rounded-xl hover:shadow-lg transition-all",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold",children:e.user.email.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900",children:e.user.email}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e.isOwner?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.isOwner?"\uD83D\uDC51 管理者":"\uD83D\uDC64 メンバー"}),(0,a.jsxs)("span",{className:"text-gray-500 text-sm",children:["参加: ",L(e.joinedAt)]})]})]})]}),M&&e.user.id!==n.id&&(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>z(e.id,e.isOwner,e.user.email),disabled:O===e.id,className:"px-3 py-1 text-sm rounded-lg font-medium transition-colors disabled:opacity-50 ".concat(e.isOwner?"border border-yellow-300 text-yellow-700 hover:bg-yellow-50":"bg-yellow-500 text-white hover:bg-yellow-600"),children:O===e.id?"処理中...":e.isOwner?"管理者解除":"管理者に昇格"}),(0,a.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>q(e.id,e.user.email),disabled:O===e.id,className:"px-3 py-1 text-sm border border-red-300 text-red-700 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50",children:"削除"})]})]},e.id))})]})]}):(0,a.jsxs)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-8 shadow-xl text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-6",children:"\uD83D\uDC65"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"チームを作成しましょう"}),(0,a.jsx)("p",{className:"text-gray-600 mb-8",children:"チームを作成して、複数のメンバーでプロジェクトを管理できます。"}),p?(0,a.jsxs)("form",{onSubmit:A,className:"max-w-md mx-auto",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"チーム名"}),(0,a.jsx)("input",{type:"text",value:v,onChange:e=>w(e.target.value),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"例: マーケティングチーム"})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:C,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all disabled:opacity-50",children:C?"作成中...":"作成"}),(0,a.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"button",onClick:()=>y(!1),className:"flex-1 border-2 border-gray-300 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-50 transition-colors",children:"キャンセル"})]})]}):(0,a.jsx)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>y(!0),className:"px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all",children:"チームを作成"})]}),g&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,a.jsxs)(s.E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-3xl p-8 max-w-md w-full relative",children:[(0,a.jsx)("button",{onClick:()=>{f(!1),N(""),k(!1)},className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:"✕"}),(0,a.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center",children:"メンバーを追加"}),(0,a.jsxs)("form",{onSubmit:F,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メールアドレス"}),(0,a.jsx)("input",{type:"email",value:j,onChange:e=>N(e.target.value),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"member@example.com"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"isOwner",checked:E,onChange:e=>k(e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),(0,a.jsx)("label",{htmlFor:"isOwner",className:"text-sm text-gray-700",children:"管理者権限を付与する"})]}),(0,a.jsx)(s.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",disabled:C,className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:C?"追加中...":"メンバーを追加"})]})]})})]})]})}},1163:function(e,l,t){e.exports=t(3079)}},function(e){e.O(0,[841,664,888,774,179],function(){return e(e.s=7773)}),_N_E=e.O()}]);