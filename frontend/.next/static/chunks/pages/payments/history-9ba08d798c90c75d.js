(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7561],{9636:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/payments/history",function(){return a(9789)}])},9789:function(e,t,a){"use strict";a.r(t);var s=a(5893),l=a(7294),r=a(5841),n=a(1163),i=a(1664),c=a.n(i);t.default=()=>{let[e,t]=(0,l.useState)(null),[i,d]=(0,l.useState)([]),[o,x]=(0,l.useState)([]),[m,h]=(0,l.useState)(null),[p,u]=(0,l.useState)(!0),[b,y]=(0,l.useState)(""),[j,g]=(0,l.useState)(null),[N,f]=(0,l.useState)("all"),v=(0,n.useRouter)();(0,l.useEffect)(()=>{let e=localStorage.getItem("user"),a=localStorage.getItem("token");e&&a?(t(JSON.parse(e)),w(),E(),S()):v.push("/login")},[v]);let w=async()=>{try{localStorage.getItem("token"),d([{id:"txn1",amount:3e5,fee:3e4,status:"completed",createdAt:"2024-01-20T10:30:00Z",stripePaymentId:"pi_1234567890",project:{id:"proj1",title:"新商品コスメのPRキャンペーン",client:{companyName:"ビューティーコスメ株式会社",contactName:"田中太郎"},matchedInfluencer:{displayName:"田中美咲"}}},{id:"txn2",amount:15e4,fee:15e3,status:"completed",createdAt:"2024-01-15T14:20:00Z",stripePaymentId:"pi_0987654321",project:{id:"proj2",title:"ライフスタイル商品のレビュー",client:{companyName:"ライフスタイル株式会社",contactName:"佐藤花子"},matchedInfluencer:{displayName:"鈴木さやか"}}}])}catch(e){console.error("Error fetching payment history:",e),y("支払い履歴の取得に失敗しました。")}finally{u(!1)}},E=async()=>{try{localStorage.getItem("token");let t={totalSpent:(null==e?void 0:e.role)==="CLIENT"?48e4:0,totalEarned:(null==e?void 0:e.role)==="INFLUENCER"?45e4:0,completedTransactions:2};h(t)}catch(e){console.error("Error fetching payment stats:",e)}},I=async e=>{if(confirm("この取引を返金しますか？この操作は取り消せません。")){g(e);try{let t=localStorage.getItem("token");if(!(await fetch("".concat("http://localhost:10000/api","/api/payments/refund/").concat(e),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})).ok)throw Error("Failed to process refund");alert("返金処理が完了しました。"),w()}catch(e){console.error("Refund error:",e),alert("返金処理に失敗しました。")}finally{g(null)}}},S=async()=>{try{let{getProjects:e}=await Promise.all([a.e(7066),a.e(2184)]).then(a.bind(a,2184)),t=await e();x((null==t?void 0:t.projects)||[])}catch(e){console.error("Error fetching projects:",e)}},k=i.filter(e=>"all"===N||e.project.id===N),C=e=>new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY",minimumFractionDigits:0}).format(e),_=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),T=e=>{switch(e){case"completed":return{label:"完了",color:"bg-green-100 text-green-800",icon:"✅"};case"failed":return{label:"失敗",color:"bg-red-100 text-red-800",icon:"❌"};case"refunded":return{label:"返金済み",color:"bg-yellow-100 text-yellow-800",icon:"↩️"};default:return{label:"不明",color:"bg-gray-100 text-gray-800",icon:"❓"}}};return p?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50",children:[(0,s.jsx)("div",{className:"bg-white/80 backdrop-blur-xl border-b border-gray-200 sticky top-0 z-10",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(c(),{href:"/dashboard",className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold",children:"IM"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"支払い履歴"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"取引履歴と統計情報"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("span",{className:"text-gray-700",children:null==e?void 0:e.email}),(0,s.jsx)(c(),{href:"/dashboard",className:"px-4 py-2 text-gray-600 hover:text-blue-600 transition-colors",children:"ダッシュボード"})]})]})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[b&&(0,s.jsx)(r.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6",children:b}),m&&(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-8 shadow-xl mb-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"支払い統計"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(null==e?void 0:e.role)==="CLIENT"&&(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-red-600 mb-2",children:C(m.totalSpent)}),(0,s.jsx)("div",{className:"text-gray-600",children:"総支払額"})]}),(null==e?void 0:e.role)==="INFLUENCER"&&(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-green-600 mb-2",children:C(m.totalEarned)}),(0,s.jsx)("div",{className:"text-gray-600",children:"総収入"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:m.completedTransactions}),(0,s.jsx)("div",{className:"text-gray-600",children:"完了した取引"})]})]})]}),(0,s.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.15},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-6 shadow-xl mb-8",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"プロジェクト:"}),(0,s.jsxs)("select",{value:N,onChange:e=>f(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[(0,s.jsx)("option",{value:"all",children:"すべてのプロジェクト"}),o.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title},e.id))]}),(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:[k.length,"件の取引"]})]})}),(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-8 shadow-xl",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"取引履歴"}),0===k.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCB3"}),(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"取引履歴がありません"}),(0,s.jsx)("p",{className:"text-gray-600",children:"all"===N?"まだ支払いや収益がありません。":"選択したプロジェクトに関する取引がありません。"})]}):(0,s.jsx)("div",{className:"space-y-4",children:k.map((t,a)=>(0,s.jsx)(r.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1*a},className:"border border-gray-200 rounded-2xl p-6 hover:shadow-lg transition-all",children:(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:t.project.title}),(0,s.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(T(t.status).color),children:[T(t.status).icon," ",T(t.status).label]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600 mb-4",children:[(null==e?void 0:e.role)==="CLIENT"&&t.project.matchedInfluencer&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"インフルエンサー:"})," ",t.project.matchedInfluencer.displayName]}),(null==e?void 0:e.role)==="INFLUENCER"&&t.project.client&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"企業:"})," ",t.project.client.companyName]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"取引日:"})," ",_(t.createdAt)]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"取引ID:"})," ",t.stripePaymentId]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"基本金額:"}),(0,s.jsx)("span",{className:"font-bold text-gray-900 ml-1",children:C(t.amount)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"手数料:"}),(0,s.jsx)("span",{className:"font-bold text-gray-900 ml-1",children:C(t.fee)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"合計:"}),(0,s.jsx)("span",{className:"font-bold text-green-600 ml-1",children:C(t.amount+t.fee)})]})]})]}),(null==e?void 0:e.role)==="CLIENT"&&"completed"===t.status&&(0,s.jsx)("div",{className:"mt-4 lg:mt-0 lg:ml-6",children:(0,s.jsx)(r.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>I(t.id),disabled:j===t.id,className:"px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:j===t.id?"処理中...":"返金"})})]})},t.id))})]}),(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},className:"bg-blue-50/80 backdrop-blur-xl border border-blue-200 rounded-3xl p-6 shadow-xl mt-8",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"\uD83D\uDCA1 支払いについて"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm text-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("span",{className:"text-blue-600 font-bold",children:"•"}),(0,s.jsx)("p",{children:"プラットフォーム手数料として基本料金の10%が加算されます"})]}),(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("span",{className:"text-blue-600 font-bold",children:"•"}),(0,s.jsx)("p",{children:"返金処理には3-5営業日かかる場合があります"})]}),(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("span",{className:"text-blue-600 font-bold",children:"•"}),(0,s.jsx)("p",{children:"すべての取引はStripeによって安全に処理されます"})]}),(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("span",{className:"text-blue-600 font-bold",children:"•"}),(0,s.jsx)("p",{children:"領収書が必要な場合はサポートにお問い合わせください"})]})]})]})]})]})}},1163:function(e,t,a){e.exports=a(3079)}},function(e){e.O(0,[5841,1664,2888,9774,179],function(){return e(e.s=9636)}),_N_E=e.O()}]);