(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7561],{9636:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/payments/history",function(){return a(9789)}])},358:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var l=a(5893),s=a(1163),r=a(8083);function n(e){let{className:t="",text:a="戻る",fallbackUrl:n="/dashboard"}=e,i=(0,s.useRouter)();return(0,l.jsxs)(r.E.button,{onClick:()=>{window.history.length>1?i.back():i.push(n)},className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-sm ".concat(t),whileHover:{scale:1.02},whileTap:{scale:.98},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.2},children:[(0,l.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),a]})}},4850:function(e,t,a){"use strict";var l=a(5893),s=a(7294),r=a(8083);t.Z=e=>{let{onDateChange:t,initialStartDate:a="",initialEndDate:n=""}=e,[i,c]=(0,s.useState)(a),[d,o]=(0,s.useState)(n),[x,m]=(0,s.useState)(null),u=e=>{let t=new Date,a=t.getFullYear(),l=t.getMonth(),s=t.getDate(),r=t.getDay();switch(e){case"today":return{start:h(t),end:h(t)};case"yesterday":let n=new Date(a,l,s-1);return{start:h(n),end:h(n)};case"thisWeek":let i=new Date(a,l,s-r),c=new Date(a,l,s+(6-r));return{start:h(i),end:h(c)};case"lastWeek":let d=new Date(a,l,s-r-7),o=new Date(a,l,s-r-1);return{start:h(d),end:h(o)};case"thisMonth":let x=new Date(a,l,1),m=new Date(a,l+1,0);return{start:h(x),end:h(m)};case"lastMonth":let u=new Date(a,l-1,1),p=new Date(a,l,0);return{start:h(u),end:h(p)};case"last7days":return{start:h(new Date(a,l,s-7)),end:h(t)};case"last30days":return{start:h(new Date(a,l,s-30)),end:h(t)};case"last90days":return{start:h(new Date(a,l,s-90)),end:h(t)};case"thisYear":let b=new Date(a,0,1),g=new Date(a,11,31);return{start:h(b),end:h(g)};default:return{start:"",end:""}}},h=e=>{let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(l)},p=e=>{m(e);let a=u(e);c(a.start),o(a.end),t(a.start,a.end)},b=e=>{c(e),m(null),t(e,d)},g=e=>{o(e),m(null),t(i,e)};return(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 shadow-lg",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"期間フィルター"}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 mb-4",children:[{label:"今日",value:"today"},{label:"昨日",value:"yesterday"},{label:"今週",value:"thisWeek"},{label:"先週",value:"lastWeek"},{label:"今月",value:"thisMonth"},{label:"先月",value:"lastMonth"},{label:"過去7日間",value:"last7days"},{label:"過去30日間",value:"last30days"},{label:"過去90日間",value:"last90days"},{label:"今年",value:"thisYear"}].map(e=>(0,l.jsx)(r.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>p(e.value),className:"px-3 py-2 rounded-lg text-sm font-medium transition-all ".concat(x===e.value?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.value))}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"開始日"}),(0,l.jsx)("input",{type:"date",value:i,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,l.jsx)("div",{className:"flex items-center justify-center pt-6",children:(0,l.jsx)("span",{className:"text-gray-500",children:"〜"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"終了日"}),(0,l.jsx)("input",{type:"date",value:d,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,l.jsx)(r.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{c(""),o(""),m(null),t("","")},className:"mt-6 px-4 py-2 bg-gray-500 text-white rounded-lg font-medium hover:bg-gray-600 transition-colors",children:"クリア"})]}),(i||d)&&(0,l.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,l.jsxs)("p",{className:"text-sm text-blue-800",children:["選択期間: ",i||"指定なし"," 〜 ",d||"指定なし"]})})]})}},9789:function(e,t,a){"use strict";a.r(t);var l=a(5893),s=a(7294),r=a(8083),n=a(1163),i=a(1664),c=a.n(i),d=a(4850),o=a(358);t.default=()=>{let[e,t]=(0,s.useState)(null),[i,x]=(0,s.useState)([]),[m,u]=(0,s.useState)([]),[h,p]=(0,s.useState)(null),[b,g]=(0,s.useState)(!0),[y,j]=(0,s.useState)(""),[f,N]=(0,s.useState)(null),[v,w]=(0,s.useState)("all"),[k,E]=(0,s.useState)(""),[D,S]=(0,s.useState)(""),I=(0,n.useRouter)();(0,s.useEffect)(()=>{let e=localStorage.getItem("user"),a=localStorage.getItem("token");e&&a?(t(JSON.parse(e)),C(),T(),P()):I.push("/login")},[I]);let C=async()=>{try{localStorage.getItem("token"),x([{id:"txn1",amount:3e5,fee:3e4,status:"completed",createdAt:"2024-01-20T10:30:00Z",stripePaymentId:"pi_1234567890",project:{id:"proj1",title:"新商品コスメのPRキャンペーン",client:{companyName:"ビューティーコスメ株式会社",contactName:"田中太郎"},matchedInfluencer:{displayName:"田中美咲"}}},{id:"txn2",amount:15e4,fee:15e3,status:"completed",createdAt:"2024-01-15T14:20:00Z",stripePaymentId:"pi_0987654321",project:{id:"proj2",title:"ライフスタイル商品のレビュー",client:{companyName:"ライフスタイル株式会社",contactName:"佐藤花子"},matchedInfluencer:{displayName:"鈴木さやか"}}}])}catch(e){console.error("Error fetching payment history:",e),j("支払い履歴の取得に失敗しました。")}finally{g(!1)}},T=async()=>{try{localStorage.getItem("token");let t={totalSpent:(null==e?void 0:e.role)==="CLIENT"?48e4:0,totalEarned:(null==e?void 0:e.role)==="INFLUENCER"?45e4:0,completedTransactions:2};p(t)}catch(e){console.error("Error fetching payment stats:",e)}},_=async e=>{if(confirm("この取引を返金しますか？この操作は取り消せません。")){N(e);try{let t=localStorage.getItem("token");if(!(await fetch("".concat("http://localhost:10000/api","/api/payments/refund/").concat(e),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})).ok)throw Error("Failed to process refund");alert("返金処理が完了しました。"),C()}catch(e){console.error("Refund error:",e),alert("返金処理に失敗しました。")}finally{N(null)}}},P=async()=>{try{let{getProjects:e}=await Promise.all([a.e(7066),a.e(2184)]).then(a.bind(a,2184)),t=await e();u((null==t?void 0:t.projects)||[])}catch(e){console.error("Error fetching projects:",e)}},L=i.filter(e=>{if("all"!==v&&e.project.id!==v)return!1;if(k||D){let t=new Date(e.createdAt).toISOString().split("T")[0];if(k&&t<k||D&&t>D)return!1}return!0}),F=e=>new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY",minimumFractionDigits:0}).format(e),M=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),R=e=>{switch(e){case"completed":return{label:"完了",color:"bg-green-100 text-green-800",icon:"✅"};case"failed":return{label:"失敗",color:"bg-red-100 text-red-800",icon:"❌"};case"refunded":return{label:"返金済み",color:"bg-yellow-100 text-yellow-800",icon:"↩️"};default:return{label:"不明",color:"bg-gray-100 text-gray-800",icon:"❓"}}};return b?(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})}):(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50",children:[(0,l.jsx)("div",{className:"bg-white/80 backdrop-blur-xl border-b border-gray-200 sticky top-0 z-10",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)(c(),{href:"/dashboard",className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-white font-bold",children:"IM"})}),(0,l.jsx)(o.Z,{text:"ダッシュボードに戻る"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"支払い履歴"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"取引履歴と統計情報"})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)("span",{className:"text-gray-700",children:null==e?void 0:e.email}),(0,l.jsx)(c(),{href:"/dashboard",className:"px-4 py-2 text-gray-600 hover:text-blue-600 transition-colors",children:"ダッシュボード"})]})]})}),(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[y&&(0,l.jsx)(r.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6",children:y}),h&&(0,l.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-8 shadow-xl mb-8",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"支払い統計"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(null==e?void 0:e.role)==="CLIENT"&&(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-3xl font-bold text-red-600 mb-2",children:F(h.totalSpent)}),(0,l.jsx)("div",{className:"text-gray-600",children:"総支払額"})]}),(null==e?void 0:e.role)==="INFLUENCER"&&(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-3xl font-bold text-green-600 mb-2",children:F(h.totalEarned)}),(0,l.jsx)("div",{className:"text-gray-600",children:"総収入"})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:h.completedTransactions}),(0,l.jsx)("div",{className:"text-gray-600",children:"完了した取引"})]})]})]}),(0,l.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.15},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-6 shadow-xl mb-8",children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"プロジェクト:"}),(0,l.jsxs)("select",{value:v,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[(0,l.jsx)("option",{value:"all",children:"すべてのプロジェクト"}),m.map(e=>(0,l.jsx)("option",{value:e.id,children:e.title},e.id))]}),(0,l.jsxs)("span",{className:"text-sm text-gray-600",children:[L.length,"件の取引"]})]}),(0,l.jsx)("div",{children:(0,l.jsx)(d.Z,{onDateChange:(e,t)=>{E(e),S(t)},initialStartDate:k,initialEndDate:D})})]})}),(0,l.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},className:"bg-white/80 backdrop-blur-xl border border-gray-200 rounded-3xl p-8 shadow-xl",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"取引履歴"}),0===L.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCB3"}),(0,l.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"取引履歴がありません"}),(0,l.jsx)("p",{className:"text-gray-600",children:"all"===v?"まだ支払いや収益がありません。":"選択したプロジェクトに関する取引がありません。"})]}):(0,l.jsx)("div",{className:"space-y-4",children:L.map((t,a)=>(0,l.jsx)(r.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1*a},className:"border border-gray-200 rounded-2xl p-6 hover:shadow-lg transition-all",children:(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:t.project.title}),(0,l.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(R(t.status).color),children:[R(t.status).icon," ",R(t.status).label]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600 mb-4",children:[(null==e?void 0:e.role)==="CLIENT"&&t.project.matchedInfluencer&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:"インフルエンサー:"})," ",t.project.matchedInfluencer.displayName]}),(null==e?void 0:e.role)==="INFLUENCER"&&t.project.client&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:"企業:"})," ",t.project.client.companyName]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:"取引日:"})," ",M(t.createdAt)]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:"取引ID:"})," ",t.stripePaymentId]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"基本金額:"}),(0,l.jsx)("span",{className:"font-bold text-gray-900 ml-1",children:F(t.amount)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"手数料:"}),(0,l.jsx)("span",{className:"font-bold text-gray-900 ml-1",children:F(t.fee)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"合計:"}),(0,l.jsx)("span",{className:"font-bold text-green-600 ml-1",children:F(t.amount+t.fee)})]})]})]}),(null==e?void 0:e.role)==="CLIENT"&&"completed"===t.status&&(0,l.jsx)("div",{className:"mt-4 lg:mt-0 lg:ml-6",children:(0,l.jsx)(r.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>_(t.id),disabled:f===t.id,className:"px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:f===t.id?"処理中...":"返金"})})]})},t.id))})]}),(0,l.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},className:"bg-blue-50/80 backdrop-blur-xl border border-blue-200 rounded-3xl p-6 shadow-xl mt-8",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"\uD83D\uDCA1 支払いについて"}),(0,l.jsxs)("div",{className:"space-y-2 text-sm text-gray-700",children:[(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,l.jsx)("span",{className:"text-blue-600 font-bold",children:"•"}),(0,l.jsx)("p",{children:"プラットフォーム手数料として基本料金の10%が加算されます"})]}),(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,l.jsx)("span",{className:"text-blue-600 font-bold",children:"•"}),(0,l.jsx)("p",{children:"返金処理には3-5営業日かかる場合があります"})]}),(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,l.jsx)("span",{className:"text-blue-600 font-bold",children:"•"}),(0,l.jsx)("p",{children:"すべての取引はStripeによって安全に処理されます"})]}),(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,l.jsx)("span",{className:"text-blue-600 font-bold",children:"•"}),(0,l.jsx)("p",{children:"領収書が必要な場合はサポートにお問い合わせください"})]})]})]})]})]})}},1163:function(e,t,a){e.exports=a(3079)}},function(e){e.O(0,[8083,1664,2888,9774,179],function(){return e(e.s=9636)}),_N_E=e.O()}]);