# パフォーマンス要件

## ページロード時間

### 初期ロード時間
- **目標**: 3 秒以内
  - First Contentful Paint (FCP): 1.2 秒以内
  - Largest Contentful Paint (LCP): 2.5 秒以内
  - Cumulative Layout Shift (CLS): 0.1 以下

### インタラクティブ化までの時間（TTI）
- **目標**: 3.5 秒以内
- **測定方法**: Google Lighthouse、Web Vitals

### ページサイズ
- **HTML**: 100 KB 以下
- **JavaScript**: 500 KB 以下（圧縮後）
- **CSS**: 100 KB 以下（圧縮後）
- **画像**: 各画像 300 KB 以下

---

## API レスポンス時間

### エンドポイント別レスポンス時間

| エンドポイント | 操作 | 目標レスポンス時間 |
|---------------|------|-----------------|
| GET /projects | 一覧取得 | 200 ms |
| GET /projects/:id | 詳細取得 | 150 ms |
| POST /projects | 作成 | 300 ms |
| PUT /projects/:id | 更新 | 250 ms |
| DELETE /projects/:id | 削除 | 150 ms |
| GET /users/:id/profile | プロフィール取得 | 100 ms |
| GET /users/:id/projects | ユーザープロジェクト一覧 | 200 ms |
| POST /payments | 支払い処理 | 1,000 ms（外部API含） |

### P95・P99 レスポンス時間
- **P95**: API レスポンス時間の 95 パーセンタイル ≤ 500 ms
- **P99**: API レスポンス時間の 99 パーセンタイル ≤ 1,000 ms

---

## データベースパフォーマンス

### クエリ実行時間
- **単一レコード取得**: 50 ms 以下
- **リスト取得（100件）**: 200 ms 以下
- **複雑なクエリ（複数テーブルJOIN）**: 500 ms 以下
- **集計クエリ**: 1,000 ms 以下

### インデックス設定
- **プライマリキー**: すべてのテーブルに設定
- **外部キー**: テーブル間リレーション用
- **検索カラム**: `email`, `username`, `status`, `created_at` など
- **複合インデックス**: 複数カラムの組み合わせ検索用

### N+1 クエリ問題
- **対策**: Prisma の include/select による最適化
- **バッチ処理**: 大量データ処理時は複数ページ処理

---

## キャッシング戦略

### クライアント側キャッシング
- **静的資産**: キャッシュ有効期限 1 年
- **API レスポンス**: キャッシュ有効期限 5-10 分
- **ユーザーセッション**: ブラウザメモリまたはローカルストレージ

### サーバー側キャッシング
- **Redis キャッシュ**: 頻繁にアクセスされるデータ
  - ユーザープロフィール: 30 分
  - プロジェクト情報: 15 分
  - ユーザー統計: 1 時間
- **データベース接続プール**: 接続の再利用

### CDN キャッシング
- **Vercel Edge Network**: 静的コンテンツ配信
- **キャッシュヘッダー設定**: 適切な Cache-Control ヘッダー

---

## スケーラビリティ

### 同時ユーザー対応
- **目標**: 10,000 同時ユーザー
- **測定方法**: 負荷テストで検証
- **スケーリング戦略**: 水平スケーリング（複数サーバー）

### データベーススケーリング
- **読み込みレプリカ**: 読み込み専用レプリカでの負荷分散
- **シャーディング**: 大規模ユーザー数対応時の検討
- **接続プール**: PgBouncer による接続管理

### API サーバースケーリング
- **複数インスタンス**: ロードバランサーで分散
- **自動スケーリング**: CPU・メモリ負荷に応じた自動増減
- **キュー処理**: 重い処理は非同期キューで処理

---

## 画像最適化

### 画像フォーマット
- **WebP 形式**: モダンブラウザ対応
- **JPEG / PNG**: フォールバック
- **SVG**: ロゴやアイコン

### 画像サイズ最適化
- **レスポンシブ画像**: srcset による複数サイズ提供
- **遅延ロード**: Lazy Load で画面下部の画像を遅延読み込み
- **圧縮**: ImageOptim・TinyPNG 等で自動圧縮

### 動的生成
- **サムネイル**: API で動的生成・キャッシュ

---

## バンドルサイズ最適化

### JavaScript バンドル
- **Code Splitting**: ページごとのコード分割
- **Tree Shaking**: 使用しないコード削除
- **ダイナミックインポート**: 必要に応じたモジュール読み込み
- **Minify**: 本番環境での自動縮小

### CSS 最適化
- **Tailwind CSS**: ユーティリティクラスによる最適化
- **Purge CSS**: 未使用クラスの削除
- **Critical CSS**: ページレンダリングに必要な CSS を優先

---

## モニタリング・分析

### パフォーマンスモニタリング
- **Google Analytics**: ユーザー側のパフォーマンス測定
- **Sentry**: エラー追跡とパフォーマンスモニタリング
- **New Relic / DataDog**: サーバー側のメトリクス監視

### メトリクス
- **Apdex スコア**: アプリケーションパフォーマンスインデックス
- **エラーレート**: API エラーレート ≤ 0.1%
- **ダウンタイム**: 99.9% の可用性（SLA）

### ダッシュボード
- **リアルタイムダッシュボード**: レスポンスタイム、エラー率の監視
- **アラート設定**: パフォーマンス低下時の通知

---

## バッチ処理・非同期処理

### 非同期タスク
- **メール送信**: キュー処理（Bull / RabbitMQ）
- **レポート生成**: バックグラウンド処理
- **画像処理**: Cloud Functions / Lambda
- **データ同期**: スケジュール実行

### バッチ処理
- **大量データインポート**: バッチで処理
- **定期実行**: Cron ジョブで統計計算など
- **ページネーション**: 大量データはページング

---

## テスト

### パフォーマンステスト
- **負荷テスト**: Apache JMeter・Locust でのテスト
- **ストレステスト**: 限界値までの負荷テスト
- **スパイク テスト**: 急激な負荷増加への対応テスト
- **エンドュランステスト**: 長時間の負荷テスト

---

**最終更新**: 2025-11-30
